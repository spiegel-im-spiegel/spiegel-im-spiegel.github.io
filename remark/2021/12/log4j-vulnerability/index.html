<!DOCTYPE html>
<html lang="ja">
<head prefix="og: http://ogp.me/ns#">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="generator" content="Hugo 0.90.1" />
<link rel="icon" type="image/x-icon" href="/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
<link rel="apple-touch-icon" type="image/png" sizes="144x144" href="/apple-icon-144x144.png">
<link rel="icon" type="image/png" sizes="192x192"  href="/android-icon-192x192.png">
<link rel="manifest" href="/manifest.json">
<link rel="canonical" href="https://text.baldanders.info/remark/2021/12/log4j-vulnerability/">
<script src="//kit.fontawesome.com/152e339e63.js"></script>
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Inconsolata%3a500,700%7cNoto+Sans+JP%3a500,700%7cNoto+Sans%3a500,700%7cNoto+Serif%7cNoto+Serif+JP&display=swap" type='text/css'>
<link rel="stylesheet" href="/css/local-font.css" type='text/css'>
<link rel="stylesheet" href="/css/baldanders-info-dark.css" type='text/css'>

<link rel="alternate" href="https://text.baldanders.info/index.xml" type="application/rss+xml" title="text.Baldanders.info">
<link rel="alternate" href="https://text.baldanders.info/index.json" type="application/json" title="text.Baldanders.info">
<meta name="google-site-verification" content="jTjBCslPtf8gwVatiY-GDgGv7pV5csa8aUOw1MRPUD4">
<title>Java 製 Logger “Log4j” の脆弱性について | text.Baldanders.info</title>
<meta property="og:title" content="Java 製 Logger “Log4j” の脆弱性について">
<meta name="description" content="2.15.0 以降にアップデートするか何らかの緩和措置を行うこと。">
<meta property="og:description" content="2.15.0 以降にアップデートするか何らかの緩和措置を行うこと。">
<meta property="og:image" content="https://text.baldanders.info/images/attention/kitten.jpg">
<meta name="author" content="Spiegel">


<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@spiegel_2007">
<meta name="twitter:creator" content="@spiegel_2007">
<meta name="keywords" content="java, security, vulnerability, logger">
<link rel='prev' href='https://text.baldanders.info/remark/2021/12/new-kindle-paperwhite/' title='Kindle Paperwhite を新調した' />

<script type="application/ld+json">
{
	"@context": "http://schema.org",
	"@type": "WebSite",
	"@id": "https://text.baldanders.info/",
	"inLanguage": "ja",
	"name": "text.Baldanders.info",
    "url": "https://text.baldanders.info/",
	"publisher": {
		"@id": "https://text.baldanders.info/#org"
	},
	"author": {
		"@id": "https://text.baldanders.info/#maker"
	},
	"image": "https://text.baldanders.info/images/attention/site.jpg",
	"description": "帰ってきた「しっぽのさきっちょ」"
}
</script>
<script type="application/ld+json">
{
	"@context": "http://schema.org",
	"@type": "Organization",
	"@id": "https://text.baldanders.info/#org",
	"name": "Spiegel",
	"logo": {
		"@type": "ImageObject",
		"@id": "https://text.baldanders.info/#logo",
		"url": "https://text.baldanders.info/images/avatar.jpg"
	}
}
</script>
<script type="application/ld+json">
{
	"@context": "http://schema.org",
	"@type": "Person",
	"@id": "https://text.baldanders.info/#maker",
	"name": "Spiegel",
	"url": "https://baldanders.info/profile/",
	"image": "https://text.baldanders.info/images/avatar.jpg"
}
</script>
<script type="application/ld+json">
{
	"@context": "http://schema.org",
	"@type": "Blog",
	"@id": "https://text.baldanders.info/remark/",
	"url": "https://text.baldanders.info/remark/",
	"inLanguage": "ja",
	"name": "しっぽのさきっちょ",
	"description": "帰ってきた「しっぽのさきっちょ」。とりとめのない四方山話。",
	"image": "https://text.baldanders.info/images/attention/remark.jpg",
	"publisher": {
		"@id": "https://text.baldanders.info/#org"
	},
	"author": {
		"@id": "https://text.baldanders.info/#maker"
	}
}
</script>
<script type="application/ld+json">
{
	"@context": "http://schema.org",
	"@type": "BreadcrumbList",
	"@id": "https://text.baldanders.info/remark/2021/12/log4j-vulnerability/#breadcrumb-list",
	"itemListElement": [
		{
			"@type": "ListItem",
			"position": 1,
			"item": {
				"@id": "https://text.baldanders.info/"
			}
		},
		{
			"@type": "ListItem",
			"position": 2,
			"item": {
				"@id": "https://text.baldanders.info/remark/"
			}
		}
	]
}
</script>
<script type="application/ld+json">
{
	"@context": "http://schema.org",
	"@type": "BlogPosting",
	"@id": "https://text.baldanders.info/remark/2021/12/log4j-vulnerability/",
	"url": "https://text.baldanders.info/remark/2021/12/log4j-vulnerability/",
	"mainEntityOfPage": "https://text.baldanders.info/remark/2021/12/log4j-vulnerability/",
	"inLanguage": "ja",
	"name": "Java 製 Logger “Log4j” の脆弱性について",
	"description": "2.15.0 以降にアップデートするか何らかの緩和措置を行うこと。",
	"headline": "2.15.0 以降にアップデートするか何らかの緩和措置を行うこと。",
	"keywords": "java, security, vulnerability, logger",
	"image": "https://text.baldanders.info/images/attention/kitten.jpg",
	"datePublished": "2021-12-11T06:22:43+00:00",
	"dateModified": "2021-12-11T06:30:34+00:00",
	"publisher": {
		"@id": "https://text.baldanders.info/#org"
	},
	"author": {
		"@id": "https://text.baldanders.info/#maker"
	},
	"license": "https://creativecommons.org/licenses/by-sa/4.0/"
}
</script>
</head>
<body>

<div id='container'>

<main>
<nav class="breadcrumb">
<a href="https://text.baldanders.info/">text.Baldanders.info</a> &raquo; <a href="/remark/">しっぽのさきっちょ</a>
</nav>
<article>
<h1>Java 製 Logger “Log4j” の脆弱性について</h1>
<nav class="tags">
	<div><a href='/tags/'>Tags</a>: #<a href="/tags/java/">java</a> #<a href="/tags/logger/">logger</a> #<a href="/tags/security/">security</a> #<a href="/tags/vulnerability/">vulnerability</a></div>
	<div class="cloud">
		<span class="share-color" title="Share this entry"><i class="fas fa-share-square"></i></span>&nbsp;:
		&nbsp;<a href="https://getpocket.com/edit?url=https%3a%2f%2ftext.baldanders.info%2fremark%2f2021%2f12%2flog4j-vulnerability%2f&amp;title=Java%20%e8%a3%bd%20Logger%20%e2%80%9cLog4j%e2%80%9d%20%e3%81%ae%e8%84%86%e5%bc%b1%e6%80%a7%e3%81%ab%e3%81%a4%e3%81%84%e3%81%a6" target="_blank"><span class="pocket-color"><i class="fab fa-get-pocket" aria-hidden="true"></i></span></a>
		&nbsp;<a href="http://www.facebook.com/share.php?u=https%3a%2f%2ftext.baldanders.info%2fremark%2f2021%2f12%2flog4j-vulnerability%2f" target="_blank"><span class="facebook-color"><i class="fab fa-facebook-square" aria-hidden="true"></i></span></a>&nbsp;<a href="http://twitter.com/share?text=Java%20%e8%a3%bd%20Logger%20%e2%80%9cLog4j%e2%80%9d%20%e3%81%ae%e8%84%86%e5%bc%b1%e6%80%a7%e3%81%ab%e3%81%a4%e3%81%84%e3%81%a6+by+@spiegel_2007&amp;url=https%3a%2f%2ftext.baldanders.info%2fremark%2f2021%2f12%2flog4j-vulnerability%2f" target="_blank"><span class="twitter-color"><i class="fab fa-twitter-square" aria-hidden="true"></i></span></a></div>
</nav>
<nav class="history">History in
  <a href="https://github.com/spiegel-im-spiegel/spiegel-im-spiegel.github.io/commits/master/remark/2021/12/log4j-vulnerability/index.html">GitHub Page</a>
</nav>

<section><div>
<div class="noextension">
<a href="https://baldanders.info/public-domain-locked/" title="Public Domain Locked... | Baldanders.info"><img src="/images/Locked-150.png" alt="no extension" width="150" /></a>
</div>
<p>私の Twitter TL では昨日あたりからちらほら見かけるようになったが Java 製の事実上の標準 logger である Apache Log4j パッケージに脆弱性があったそうで，最新版 2.15.0 のアナウンスが出ている。
ちょっと大事になりそうな気がするので，この記事で覚え書きとして残しておく。</p>
<h2><a href="https://nvd.nist.gov/vuln/detail/CVE-2021-44228">CVE-2021-44228</a></h2>
<figure lang="en">
<blockquote><q>Apache Log4j2 &lt;=2.14.1 JNDI features used in configuration, log messages, and parameters do not protect against attacker controlled LDAP and other JNDI related endpoints. An attacker who can control log messages or log message parameters can execute arbitrary code loaded from LDAP servers when message lookup substitution is enabled. From log4j 2.15.0, this behavior has been disabled by default</q>.</blockquote>
<figcaption><div>via <q><a href="https://logging.apache.org/log4j/2.x/security.html">Log4j – Apache Log4j Security Vulnerabilities</a></q></div></figcaption>
</figure>
<p>ちょっと分かりにくいかもしれないので，以下の解説記事も参考にどうぞ。</p>
<figure>
<blockquote><p>今回問題となっているのはJndi Lookupだ。これはJavaのJava Naming and Directory Interfaceによる変数名の置換で、ネットワーク越しに変数に相当する値を検索することができる。その中にLDAPも含まれる。例えば<code>&quot;${jndi:ldap://someremoteclass}&quot;</code>のようになる。</p>
<p>問題は、このURLに.を含めることにより、lg4jは任意のリモートのLDAPサーバーからjava classファイルをダウンロードして読み込んでしまうのだ。</p>
<p>なので悪意あるjava classファイルとそれをホストするLDAPサーバーを用意して、ターゲットとなるJavaで動きlog4jを使っているプログラムに<code>&quot;${jndi:ldap://URL}&quot;</code>の形でログ出力されるようにすれば、任意のコード実行が可能になる。</p>
</blockquote>
<figcaption><div><q><a href="https://ezoeryou.github.io/blog/article/2021-12-10-log4j.html">log4jの脆弱性について</a></q>より</div></figcaption>
</figure>
<p>ここまで言及されれば今回の脆弱性のヤバさが分かるだろう。
サービス側にログが吐かれるだけでこの脆弱性が発火する可能性があるのだ。
これは私達が目にしている各種サービスだけではなく，たとえばバックエンドで外部の Web API サービスを利用しているのならそちらも考慮する必要がある。
あるいは，もしかしたら組込み製品でアプリケーションを Java で組んでいるかもしれない。</p>
<p>Apache Log4j はこの脆弱性の CVSS 評価値を</p>
<ul>
<li><code>CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H</code></li>
<li>深刻度: 緊急 (Score: 10)</li>
</ul>
<table>
<thead>
<tr>
<th>基本評価基準</th>
<th>評価値</th>
</tr>
</thead>
<tbody>
<tr>
<td>攻撃元区分</td>
<td>ネットワーク</td>
</tr>
<tr>
<td>攻撃条件の複雑さ</td>
<td>低</td>
</tr>
<tr>
<td>必要な特権レベル</td>
<td>不要</td>
</tr>
<tr>
<td>ユーザ関与レベル</td>
<td>不要</td>
</tr>
<tr>
<td>スコープ</td>
<td>変更あり</td>
</tr>
<tr>
<td>機密性への影響</td>
<td>高</td>
</tr>
<tr>
<td>完全性への影響</td>
<td>高</td>
</tr>
<tr>
<td>可用性への影響</td>
<td>高</td>
</tr>
</tbody>
</table>
<p>と見積もっている。</p>
<p>一応，サービス側の緩和措置も示されているので「すぐに対応できないよー」という場合は参考にするといいだろう。</p>
<figure lang="en">
<blockquote><q>In releases &gt;=2.10, this behavior can be mitigated by setting either the system property <code>log4j2.formatMsgNoLookups</code> or the environment variable <code>LOG4J_FORMAT_MSG_NO_LOOKUPS</code> to <code>true</code>. For releases from 2.0-beta9 to 2.10.0, the mitigation is to remove the <code>JndiLookup</code> class from the classpath: <code>zip -q -d log4j-core-*.jar org/apache/logging/log4j/core/lookup/JndiLookup.class</code></q>.</blockquote>
<figcaption><div>via <q><a href="https://logging.apache.org/log4j/2.x/security.html">Log4j – Apache Log4j Security Vulnerabilities</a></q></div></figcaption>
</figure>
<p>とりあえずシステム・プロパティまたは環境変数で対応って感じかねぇ。</p>
<p>アップデートは計画的に。</p>
<h2>ブックマーク</h2>
<ul>
<li><a href="https://github.com/advisories/GHSA-jfh8-c2jp-5v3q">Remote code injection in Log4j · CVE-2021-44228 · GitHub Advisory Database · GitHub</a></li>
<li><a href="https://www.oracle.com/security-alerts/alert-cve-2021-44228.html">Oracle Security Alert Advisory - CVE-2021-44228</a></li>
<li><a href="https://nakedsecurity.sophos.com/2021/12/10/log4shell-java-vulnerability-how-to-safeguard-your-servers/">“Log4Shell” Java vulnerability – how to safeguard your servers – Naked Security</a></li>
<li><a href="https://www.abc.net.au/news/2021-12-11/log4shell-techs-race-to-fix-software-flaw/100692876">Log4shell software flaw threatens millions of servers as hackers scramble to exploit it - ABC News</a></li>
<li><a href="https://aws.amazon.com/security/security-bulletins/AWS-2021-005/">Apache Log4j2 Security Bulletin (CVE-2021-44228)</a></li>
<li><a href="https://github.com/Cybereason/Logout4Shell">Cybereason/Logout4Shell: Use Log4Shell vulnerability to vaccinate a victim server against Log4Shell</a></li>
</ul>
<!-- eof -->

</div></section>

</article>
</main>
<nav class="page-nav">
<div class="prev-page">&laquo; <a href="/remark/2021/12/new-kindle-paperwhite/">Kindle Paperwhite を新調した</a></div>
<div class="next-page"></div>
</nav>

<aside class="feedback" id='feedback'>
<h1>Feedback</h1>
<p>GitHub に<a href="https://github.com/spiegel-im-spiegel/github-pages-env/discussions">フィードバック用のディスカッションページ</a>を用意しました。
書き込みには GitHub のアカウントが必要ですが，お気軽にご利用ください。</p>
<p>他のフィードバック手段として Twitter, Facebook または電子メールも利用できます。電子メールを利用する際の公開鍵は<a href="https://baldanders.info/profile/">プロフィール</a>から取得できます。</p>
</aside>
<footer>


<div class="userinfo">
	<div class="userinfo-avater">
		<a href="https://baldanders.info/profile/"><img src="https://text.baldanders.info/images/avatar.jpg" width="48" height="48" alt="avatar" id="logo"></a>
	</div>
	<div class="userinfo-info" id="maker">
		Text by <a href="https://baldanders.info/profile/" rel="cc:attributionURL" property="cc:attributionName">Spiegel</a>
		in <time property='dc:dateCopyrighted'>2021-12-11</time>
		<a rel='cc:license' href="https://creativecommons.org/licenses/by-sa/4.0/"><i class="fab fa-creative-commons"></i>&nbsp;<i class="fab fa-creative-commons-by"></i>&nbsp;<i class="fab fa-creative-commons-sa"></i></a>
		<ul class="social"><li><a href="https://github.com/spiegel-im-spiegel"><span class="github-color"><i class="fab fa-github"></i></span></a></li><li><a href="https://www.flickr.com/photos/spiegel/"><span class="flickr-color"><i class="fab fa-flickr"></i></span></a></li><li><a href="https://twitter.com/spiegel_2007"><span class="twitter-color"><i class="fab fa-twitter"></i></span></a></li></ul>
	</div>
</div>

<nav>
<ul class='cloud center'>
<li><a href='https://github.com/spiegel-im-spiegel/spiegel-im-spiegel.github.io'>Repository</a></li>
<li><a href='/reviews/'>Reviews</a></li>
<li><a href='/about-feeds/'>Feeds</a></li>
<li><a href='/site-policy/'>Policy</a></li>
<li><a href='https://validator.w3.org/nu/?doc=https%3a%2f%2ftext.baldanders.info%2fremark%2f2021%2f12%2flog4j-vulnerability%2f&amp;showoutline=yes'>Debug</a></li>
</ul>
<ul class='cloud center'>
<li><a href='https://baldanders.info/'>Home</a></li>
<li><a href='https://photo.baldanders.info/'>Photos</a></li>
<li><a href='https://slide.baldanders.info/'>Slide</a></li>
<li><a href='https://zenn.dev/spiegel'>Zenn</a></li>
</ul>
<ul class='cloud center'>
<li>Powered by <a href='https://gohugo.io/'>Hugo 0.90.1</a> and <a href="https://github.com/spiegel-im-spiegel/hugo-theme-baldanders-info
">Theme of Baldanders.info</a>.</li>
</ul>
</nav>
</footer>
</div>

</body>
</html>
