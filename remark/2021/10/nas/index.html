<!DOCTYPE html>
<html lang="ja">
<head prefix="og: http://ogp.me/ns#">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="generator" content="Hugo 0.121.2">
<link rel="icon" type="image/x-icon" href="/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
<link rel="apple-touch-icon" type="image/png" sizes="144x144" href="/apple-icon-144x144.png">
<link rel="icon" type="image/png" sizes="192x192"  href="/android-icon-192x192.png">
<link rel="manifest" href="/manifest.json">
<link rel="canonical" href="https://text.baldanders.info/remark/2021/10/nas/">
<script defer src="/fa/js/all.min.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=BIZ+UDGothic:wght@400;700&family=BIZ+UDMincho&family=Inconsolata:wght@400;700&family=Noto+Color+Emoji&family=Noto+Sans:wght@400;700&family=Noto+Serif&display=swap" rel="stylesheet">
<link rel="stylesheet" href="/css/local-font.css" type='text/css'>
<link rel="stylesheet" href="/css/baldanders-info-dark.css" type='text/css'>

<link rel="alternate" href="https://text.baldanders.info/index.xml" type="application/rss+xml" title="text.Baldanders.info">
<link rel="alternate" href="https://text.baldanders.info/index.json" type="application/json" title="text.Baldanders.info">
<meta name="google-site-verification" content="jTjBCslPtf8gwVatiY-GDgGv7pV5csa8aUOw1MRPUD4">
<title>秋 NAS は俺に喰わせろ！ | text.Baldanders.info</title>
<meta property="og:title" content="秋 NAS は俺に喰わせろ！">
<meta name="description" content="金曜の夜にポチって中1日で届くとは思わざりき（笑）">
<meta property="og:description" content="金曜の夜にポチって中1日で届くとは思わざりき（笑）">
<meta property="og:image" content="https://text.baldanders.info/images/attention/kitten.jpg">
<meta name="author" content="Spiegel">


<meta name="twitter:card" content="summary">
<link rel="me" href="https://fedibird.com/@spiegel">
<meta name="keywords" content="nas, samba, ubuntu, cloud, nfs, git">
<link rel='prev' href='https://text.baldanders.info/remark/2021/10/toughness-of-system/' title='人の靭性' />
<link rel='next' href='https://text.baldanders.info/remark/2021/10/tailscale-with-synology-nas/' title='Synology NAS に Tailscale を設定する' />

<script type="application/ld+json">
{
	"@context": "http://schema.org",
	"@type": "WebSite",
	"@id": "https://text.baldanders.info/",
	"inLanguage": "ja",
	"name": "text.Baldanders.info",
    "url": "https://text.baldanders.info/",
	"publisher": {
		"@id": "https://text.baldanders.info/#org"
	},
	"author": {
		"@id": "https://text.baldanders.info/#maker"
	},
	"image": "https://text.baldanders.info/images/attention/site.jpg",
	"description": "帰ってきた「しっぽのさきっちょ」"
}
</script>
<script type="application/ld+json">
{
	"@context": "http://schema.org",
	"@type": "Organization",
	"@id": "https://text.baldanders.info/#org",
	"name": "Spiegel",
	"logo": {
		"@type": "ImageObject",
		"@id": "https://text.baldanders.info/#logo",
		"url": "https://text.baldanders.info/images/avatar.jpg"
	}
}
</script>
<script type="application/ld+json">
{
	"@context": "http://schema.org",
	"@type": "Person",
	"@id": "https://text.baldanders.info/#maker",
	"name": "Spiegel",
	"url": "https://baldanders.info/profile/",
	"image": "https://text.baldanders.info/images/avatar.jpg"
}
</script>
<script type="application/ld+json">
{
	"@context": "http://schema.org",
	"@type": "Blog",
	"@id": "https://text.baldanders.info/remark/",
	"url": "https://text.baldanders.info/remark/",
	"inLanguage": "ja",
	"name": "しっぽのさきっちょ",
	"description": "帰ってきた「しっぽのさきっちょ」。とりとめのない四方山話。",
	"image": "https://text.baldanders.info/images/attention/remark.jpg",
	"publisher": {
		"@id": "https://text.baldanders.info/#org"
	},
	"author": {
		"@id": "https://text.baldanders.info/#maker"
	}
}
</script>
<script type="application/ld+json">
{
	"@context": "http://schema.org",
	"@type": "BreadcrumbList",
	"@id": "https://text.baldanders.info/remark/2021/10/nas/#breadcrumb-list",
	"itemListElement": [
		{
			"@type": "ListItem",
			"position": 1,
			"item": {
				"@id": "https://text.baldanders.info/"
			}
		},
		{
			"@type": "ListItem",
			"position": 2,
			"item": {
				"@id": "https://text.baldanders.info/remark/"
			}
		}
	]
}
</script>
<script type="application/ld+json">
{
	"@context": "http://schema.org",
	"@type": "BlogPosting",
	"@id": "https://text.baldanders.info/remark/2021/10/nas/",
	"url": "https://text.baldanders.info/remark/2021/10/nas/",
	"mainEntityOfPage": "https://text.baldanders.info/remark/2021/10/nas/",
	"inLanguage": "ja",
	"name": "秋 NAS は俺に喰わせろ！",
	"description": "金曜の夜にポチって中1日で届くとは思わざりき（笑）",
	"headline": "金曜の夜にポチって中1日で届くとは思わざりき（笑）",
	"keywords": "nas, samba, ubuntu, cloud, nfs, git",
	"image": "https://text.baldanders.info/images/attention/kitten.jpg",
	"datePublished": "2021-10-26T14:50:36+00:00",
	"dateModified": "2021-11-14T07:13:40+00:00",
	"publisher": {
		"@id": "https://text.baldanders.info/#org"
	},
	"author": {
		"@id": "https://text.baldanders.info/#maker"
	},
	"license": "https://creativecommons.org/licenses/by-sa/4.0/"
}
</script>
</head>
<body>

<div id='container'>

<main>
<nav class="breadcrumb">
<a href="https://text.baldanders.info/">text.Baldanders.info</a> &raquo; <a href="/remark/">しっぽのさきっちょ</a>
</nav>
<article>
<h1>秋 NAS は俺に喰わせろ！</h1>
<nav class="tags">
	<div><a href='/tags/'>Tags</a>: #<a href="/tags/cloud/">cloud</a> #<a href="/tags/git/">git</a> #<a href="/tags/nas/">nas</a> #<a href="/tags/nfs/">nfs</a> #<a href="/tags/samba/">samba</a> #<a href="/tags/ubuntu/">ubuntu</a></div>
	<div class="cloud">
		<span class="share-color" title="Share this entry"><i class="fas fa-share-square"></i></span>&nbsp;:
		&nbsp;<a href="https://getpocket.com/edit?url=https%3a%2f%2ftext.baldanders.info%2fremark%2f2021%2f10%2fnas%2f&amp;title=%e7%a7%8b%20NAS%20%e3%81%af%e4%bf%ba%e3%81%ab%e5%96%b0%e3%82%8f%e3%81%9b%e3%82%8d%ef%bc%81" target="_blank"><span class="pocket-color"><abbr title="Share Pocket"><i class="fab fa-get-pocket" aria-hidden="true"></i></abbr></span></a>
		&nbsp;<a href="http://www.facebook.com/share.php?u=https%3a%2f%2ftext.baldanders.info%2fremark%2f2021%2f10%2fnas%2f" target="_blank"><span class="facebook-color"><abbr title="Share facebook"><i class="fab fa-facebook-square" aria-hidden="true"></i></abbr></span></a>
		&nbsp;<a href="http://twitter.com/share?text=%e7%a7%8b%20NAS%20%e3%81%af%e4%bf%ba%e3%81%ab%e5%96%b0%e3%82%8f%e3%81%9b%e3%82%8d%ef%bc%81&amp;url=https%3a%2f%2ftext.baldanders.info%2fremark%2f2021%2f10%2fnas%2f" target="_blank"><span class="twitter-color"><abbr title="Share Twitter"><i class="fab fa-twitter-square" aria-hidden="true"></i></abbr></span></a>
		&nbsp;<a href="https://donshare.net/share.html?text=%e7%a7%8b%20NAS%20%e3%81%af%e4%bf%ba%e3%81%ab%e5%96%b0%e3%82%8f%e3%81%9b%e3%82%8d%ef%bc%81+by+@spiegel%40fedibird.com+https%3a%2f%2ftext.baldanders.info%2fremark%2f2021%2f10%2fnas%2f" target="_blank"><span class="mastodon-color"><abbr title="Share Mastodon"><i class="fa-brands fa-mastodon"></i></abbr></span></a>
	</div>
</nav>
<nav class="history">History in
  <a href="https://github.com/spiegel-im-spiegel/spiegel-im-spiegel.github.io/commits/master/remark/2021/10/nas/index.html">GitHub Page</a>
</nav>

<section><div>
<div class="noextension">
<a href="https://baldanders.info/public-domain-locked/" title="Public Domain Locked... | Baldanders.info"><img src="/images/Locked-150.png" alt="no extension" width="150" /></a>
</div>
<p>勤務先で LAN 上の NAS やクラウド・ストレージの構成を見直す動きが出ていて「そういや私が簡易 NAS を導入したのっていつだっけ？」と過去記事を漁ってみたら3年半も前だったよ。</p>
<ul>
<li><a href="https://text.baldanders.info/remark/2018/04/nas/">NAS を導入した</a></li>
</ul>
<p>その半年後に<a href="https://text.baldanders.info/remark/2018/12/i-am-a-sunday-programmer/" title="どうも，日曜プログラマの Spiegel です">田舎に<ruby><rb>帰郷</rb><rp> (</rp><rt>かえ</rt><rp>) </rp></ruby>る羽目になった</a>のだが，当時は Windows を捨てる準備に入ろうかというところで，バックアップと書き戻し用に（OS を跨いで）アクセスできる共有ストレージが欲しかったんだよね。</p>
<p>導入して良かった点は LAN 上の NAS とクラウド・ストレージ・サービスを連携させることで，そこそこ安全で快適な環境を手に入れられたことだろう。
とはいえ RAID 0 すら組んでない簡易設備でこのまま運用を続けるのはもう限界だろうと思い直したわけだ。</p>
<p>で，まぁ，あれこれ迷った挙句に買ったのは <a href="https://www.synology.com/ja-jp/products/DS220j" title="DS220j | Synology Inc.">Synology DS220j</a> ってやつ。
今回も<a href="https://www.dospara.co.jp/">ドスパラ</a>さんのお世話になりました。
<a href="https://www.dospara.co.jp/5shopping/detail_set.php?bg=&amp;br=&amp;sbr=&amp;camp=1804&amp;ft=synology&amp;lf=2" title="【HDD+ドライブケース】Synology NAS + 選べる W.D HDD 3点セット｜｜｜通販のドスパラ">HDD 2基と3点セット</a>になってるやつをポチった。</p>
<p>本当はポチってから数日あけて来ることを想定してたんだけど，金曜の夜にポチって中1日で（松江みたいな片田舎まで）届くとは思わざりき（笑）</p>
<figure style='margin:0 auto;text-align:center;'><a href="https://www.flickr.com/photos/spiegel/51625630824/"><img src="./51625630824_e1ae072032_e.jpg" srcset="./51625630824_e1ae072032_e.jpg 500w" sizes="(min-width:600px) 500px, 80vw" alt="秋 NAS 来た！ | Flickr" loading="lazy"></a><figcaption><div><a href="https://www.flickr.com/photos/spiegel/51625630824/">秋 NAS 来た！ | Flickr</a></div></figcaption>
</figure>
<p>ありがたいことに「NAS 初心者ガイド」という日本語の冊子がついていた。
これのおかげでセットアップ自体は比較的スムーズにできた。
ブラウザで Web Assistant を開いたときに最初はうまく検出できなかったくらい（ブラウザを立ち上げ直したら上手くいった）かな？</p>
<h2>RAID (Redundant Arrays of Inexpensive Disks)</h2>
<p>RAID は SHR (Synology Hybrid RAID) にした。
RAID 1 とかだと ストレージの容量やメーカーを揃える必要があるが， SHR はその辺は柔軟に運用できるらしい。</p>
<ul>
<li><a href="https://kb.synology.com/ja-jp/DSM/tutorial/What_is_Synology_Hybrid_RAID_SHR">Synology Hybrid RAID（SHR）とは？ - Synology ナレッジセンター</a></li>
</ul>
<h2>QuickConnect は無効にした</h2>
<p>最初は Synology アカウントを取得して QuickConnect も使ってたんだが，どうにも気持ち悪いので QuickConnect はいったん無効にした。
Synology アカウントは有効にしてるので，必要になったらまた復活させればいいだろう。</p>
<p>VPN 接続は <a href="https://www.synology.com/ja-jp/dsm/packages/Tailscale?os_ver=7.0" title="Tailscale - アドオン パッケージ | Synology Inc.">Tailscale</a> を検討中&hellip;</p>
<h2>Ubuntu ファイルマネージャから SMB サービスに入れない</h2>
<p><a href="https://www.ubuntu.com/" title="The leading operating system for PCs, IoT devices, servers and the cloud | Ubuntu">Ubuntu</a> 標準のファイルマネージャ（<code>nautilus</code>）は LAN 上の Windows 共有フォルダや <a href="https://www.samba.org/" title="Samba - opening windows to a wider world">Samba</a> サービスを自動的に検出・表示してくれる。
<a href="https://www.synology.com/ja-jp/products/DS220j" title="DS220j | Synology Inc.">DS220j</a> も SMB (Server Message Block) が使えるので Windows ネットワークと同じように表示されるんだけど，クリックしても何故か入れないのよね。</p>
<figure style='margin:0 auto;text-align:center;'><a href="./samba-error.png"><img src="./samba-error.png" srcset="./samba-error.png 626w" sizes="(min-width:600px) 500px, 80vw" alt="" loading="lazy"></a></figure>
<p>なんやねん「無効な引数」て <code>orz</code></p>
<p>これは現在に至るも改善しない（理由がわからないので）。
ただし <code>mount.cifs</code> でマウントはできるし <code>/etc/fstab</code> ファイルへの記述もちゃんと効いたので実害はない。
多分ファイルマネージャ側の問題なんだろうなぁ。
CIFS 経由で NAS に接続する方法は以下の通り。</p>
<ul>
<li><a href="https://text.baldanders.info/remark/2019/03/common-internet-file-system/">CIFS 経由で NAS に接続する</a></li>
</ul>
<p>ちなみに Android の <a href="https://play.google.com/store/apps/details?id=com.skyjos.apps.fileexplorer" title="File Explorer Pro - file manager and file transfer - Google Play">FE File Explorer Pro</a> からは普通に見れた。</p>
<h2>Ubuntu から NFS サービスに入れない</h2>
<p><a href="https://www.ubuntu.com/" title="The leading operating system for PCs, IoT devices, servers and the cloud | Ubuntu">Ubuntu</a> に NFS クライアントを導入する。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">$ sudo apt install nfs-common
</span></span></code></pre></div><p><a href="https://www.synology.com/ja-jp/products/DS220j" title="DS220j | Synology Inc.">DS220j</a> 側の NFS サービスを有効化して <a href="https://www.ubuntu.com/" title="The leading operating system for PCs, IoT devices, servers and the cloud | Ubuntu">Ubuntu</a> からアクセスしようとしたが上手くいかない。
まぁ，考えてみたら当たり前で Kerberos を使ってアカウントのマッピングでもするのならともかく，家庭内 LAN ごときでそこまでしないし，しないなら見えなくても仕方ない。</p>
<figure>
<blockquote><p><strong>セキュリティ フレーバー：</strong></p>
<p>特定のユーザー アカウントで NFS を介して共有フォルダにアクセスする場合：</p>
<ul>
<li><strong>AUTH_SYS</strong> セキュリティが導入されている場合：クライアントは NFS クライアントと Synology NAS で全く同じ UID（ユーザー識別子）と GID（グループ識別子）を持っていなければなりません。そうしなければ、クライアントが共有フォルダにアクセスするときに、<strong>「others」<strong>という許可が割り当てられます。権限が競合しないように、</strong>[Squash]</strong> から <strong>[全ユーザーを admin にマップ]</strong> を選択するか、共有フォルダに｢Everyone｣権限を割り当てます。</li>
<li><strong>Kerberos (krb5、krb5i、krb5p)</strong> セキュリティが導入されている場合：<strong>[ファイル サービス]</strong> &gt; <strong>[NFS]</strong> &gt; <strong>[NFS サービスの有効化]</strong> &gt; <strong>[詳細設定]</strong> &gt; <strong>[Kerberos の設定]</strong> の順にを選択して、NFS クライアントを特定のユーザーに割り当てなければなりません。または、相当するユーザー アカウントで Windows/LDAP ドメインに加わります。そうしなければ、クライアントが共有フォルダにアクセスするときに、「guest」という許可が割り当てられます。</li>
<li>共有フォルダを作成する拡張デバイスのファイル システムが NTFS または FAT の場合は、<strong>[すべてのユーザーを admin にマップ]</strong> オプションが強制的に適用されます。</li>
</ul>
<p>Synology NAS に接続するために Kerberos セキュリティを使用するには、<strong>[ファイル サービス]</strong> &gt; <strong>[NFS]</strong> &gt; <strong>[NFS サービスの有効化]</strong> &gt; <strong>[詳細設定]</strong> &gt; <strong>[Kerberos の設定]</strong> の順に選択して、Kerberos 認証が設定されていなければなりません。</p>
</blockquote>
<figcaption><div><q><a href="https://kb.synology.com/ja-jp/DSM/help/DSM/AdminCenter/file_share_privilege_nfs?version=7">NFS 権限を割り当てる | DSM - Synology ナレッジセンター</a></q>より</div></figcaption>
</figure>
<p>というわけで，今回は 権限を「カスタマイズ」して <code>Everyone</code> 権限を追加・設定した。
複数人で使う場合は NFS は使わんほうがいいかもなぁ。</p>
<p>ちなみに <code>/etc/fstab</code> ファイルを使ってマウントする場合には</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">sy-nas:/volumeX/homes/username /home/username/nas-home nfs rsize=8192,wsize=8192,timeo=14,intr 0 0
</span></span></code></pre></div><p>などとすればよい。</p>
<h2>Cloud Sync</h2>
<p>パッケージ・センターから <a href="https://www.synology.com/ja-jp/dsm/feature/cloud_sync" title="Cloud Sync | Synology Inc.">Cloud Sync</a> をインストールしてクラウド・ストレージと連携できるようにした。</p>
<p><a href="https://www.synology.com/ja-jp/dsm/feature/cloud_sync" title="Cloud Sync | Synology Inc.">Cloud Sync</a> は Google Drive, Dropbox, Box, Microsoft OneDrive あるいは Azure Storage, Google Cloud Storage, S3 storage といったメジャー・サービスはもちろん，一般的な WebDAV とも連携できるらしい。</p>
<p>さらに <a href="https://www.synology.com/ja-jp/dsm/feature/cloud_sync" title="Cloud Sync | Synology Inc.">Cloud Sync</a> では</p>
<figure style='margin:0 auto;text-align:center;'><a href="./cloud-storage-encrypt.png"><img src="./cloud-storage-encrypt.png" srcset="./cloud-storage-encrypt.png 630w" sizes="(min-width:600px) 500px, 80vw" alt="" loading="lazy"></a></figure>
<p>てな感じに同期データの暗号化ができる。
具体的には <a href="https://www.synology.com/ja-jp/dsm/feature/cloud_sync" title="Cloud Sync | Synology Inc.">Cloud Sync</a> からアップロードする際に暗号化された状態でアップロードされる。
元々クラウド・ストレージ側に置いてあるファイルは暗号化の対象にならない。
暗号化ファイルは NAS 側では復号された状態で格納されており，クラウド・ストレージ側で暗号化されているか否かに関係なく透過的に扱うことができる。</p>
<p>クラウド・ストレージって便利で使い勝手がいいけど，他人のデータを覗き見る痴漢野郎がいるぢゃん。
Google とか <a href="https://text.baldanders.info/remark/2021/08/apples-mass-surveillance-plans/">Apple</a> とか。
だから積極的には使わないようにしてたんだけど，これで踏ん切りがついたわ。</p>
<p>物置用のクラウド・ストレージ・サービスとして Google Drive をデータ暗号化した上で利用することにした。
これに伴い <a href="https://one.google.com/">Google One</a> の<a href="https://one.google.com/about/plans" title="プランと料金設定 - Google One">有料プラン</a>へアップグレードした。</p>
<p>運用中の各種クラウド・ストレージ・サービスに置いてあるファイルを整理しないとな。</p>
<h2>Git Server と SSH</h2>
<p>パッケージ・センターで <a href="https://www.synology.com/ja-jp/dsm/packages/Git?os_ver=7.0" title="Git Server - アドオン パッケージ | Synology Inc.">Git Server</a> を見つけたのでインストールしてみたのだが&hellip;</p>
<p>どうやら SSH ベースのサーバのようだが</p>
<ul>
<li><a href="https://kb.synology.com/ja-jp/DSM/help/Git/git?version=7">Git Server - Synology ナレッジセンター</a></li>
</ul>
<p>そもそも <a href="https://www.synology.com/ja-jp/products/DS220j" title="DS220j | Synology Inc.">DS220j</a> は管理者権限を持つアカウントしか SSH を使えないようになっている。
なので <a href="https://www.synology.com/ja-jp/dsm/packages/Git?os_ver=7.0" title="Git Server - アドオン パッケージ | Synology Inc.">Git Server</a> へのアクセス専用にグループとユーザを作成し，専用の共有フォルダを設定する必要がある。</p>
<p>更に言うとユーザ・ホーム・サービスを有効にしておく必要がある。</p>
<figure style='margin:0 auto;text-align:center;'><a href="./user-home-service.png"><img src="./user-home-service.png" srcset="./user-home-service.png 642w" sizes="(min-width:600px) 500px, 80vw" alt="" loading="lazy"></a></figure>
<p>これがないと公開鍵認証ができないらしい。</p>
<ul>
<li><a href="https://qiita.com/shimizumasaru/items/56474d98e723ea1b5ae3">Synology DiskStation で SSH 接続を公開鍵認証方式にする - Qiita</a></li>
</ul>
<p>まぁ，ぼちぼち進めるか。</p>
<h3>【2021-10-30 追記】 Synology SSH に公開鍵認証でログインする</h3>
<p>まずはおとなしくパスワード認証で入る。
前節で述べたように Git Server 用に専用のユーザとグループを作ってログイン可能な状態にすること（今回はユーザ：グループ名を <code>git:git</code> とした<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>）。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">$ ssh git@sy-nas
</span></span><span class="line"><span class="cl">git@sy-nas&#39;s password: 
</span></span></code></pre></div><p>ログイン直後のホーム・ディレクトリはこんな感じ。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">$ pwd
</span></span><span class="line"><span class="cl">/var/services/homes/git
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ ll
</span></span><span class="line"><span class="cl">drwxrwxrwx+ 2 git  users 4096 Oct 30 00:00 .
</span></span><span class="line"><span class="cl">drwxrwxrwx+ 9 root root  4096 Oct 30 00:00 ..
</span></span></code></pre></div><p>このままでは拙いので，ホーム・ディレクトリのパーミッションを変更する。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">chmod 755 /var/services/homes/git
</span></span></code></pre></div><p>次にホーム・ディレクトリ直下に <code>.ssh</code> ディレクトリを作成する。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">$ mkdir .ssh
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ ll
</span></span><span class="line"><span class="cl">drwxr-xr-x  3 git  users 4096 Oct 30 00:00 .
</span></span><span class="line"><span class="cl">drwxrwxrwx+ 9 root root  4096 Oct 30 00:00 ..
</span></span><span class="line"><span class="cl">drwxr-xr-x  2 git  users 4096 Oct 30 00:00 .ssh
</span></span></code></pre></div><p>この <code>.ssh</code> ディレクトリ直下に <code>authorized_keys</code> ファイルを作り SSH 公開鍵を登録する。
ちなみに公開鍵は ECC 鍵が使える。
ECC 鍵を作ってサーバに登録する方法は以下の通り。</p>
<ul>
<li><a href="https://text.baldanders.info/remark/2020/06/upgrade-openssh-key/">OpenSSH 鍵をアップグレードする</a></li>
</ul>
<p>また SSH 鍵を GnuPG で作成・管理する方法は以下を参考にどうぞ。</p>
<ul>
<li><a href="https://text.baldanders.info/openpgp/ssh-key-management-with-gnupg/">OpenSSH の認証鍵を GunPG で作成・管理する</a></li>
</ul>
<p><code>.ssh</code> ディレクトリおよび <code>.ssh/authorized_keys</code> ファイルのパーミッションに注意。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">$ chmod 700 ~/.ssh
</span></span><span class="line"><span class="cl">$ chmod 600 ~/.ssh/authorized_keys
</span></span></code></pre></div><p>これで適当なターミナルを立ち上げて</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">$ ssh git@sy-nas
</span></span></code></pre></div><p>でパスワード認証ではなく公開鍵認証が動き出したら成功である<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>（作業中の SSH セッションは維持しておくこと。しくじってアクセスできなくなったら困るからね）。</p>
<h3>【2021-10-30 追記】 試しにリポジトリを作ってみる</h3>
<p>Git Server 用に専用の共有フォルダを作る。
今回は <code>gitrepos</code> という名前で共有フォルダを作った。
前節の <code>git</code> ユーザで読み書きできるようにしておくこと（他のユーザはアクセスできなくてよい）。</p>
<p>さっそく <code>gitrepos</code> 共有フォルダに入ってみる。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">$ ssh git@sy-nas
</span></span><span class="line"><span class="cl">$ cd /volume1/gitrepos/
</span></span><span class="line"><span class="cl">$ sudo chown git:git /volume1/gitrepos
</span></span><span class="line"><span class="cl">$ chmod 755 /volume1/gitrepos
</span></span></code></pre></div><p>たぶん必須ではないが気持ち悪いので，所有者とパーミッションを変更して <code>git</code> ユーザ専用にした。
では，適当なベア・リポジトリを作ってみよう。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">$ mkdir hello-repos
</span></span><span class="line"><span class="cl">$ cd hello-repos/
</span></span><span class="line"><span class="cl">$ git init --bare
</span></span><span class="line"><span class="cl">Initialized empty Git repository in /volume1/gitrepos/hello-repos/
</span></span></code></pre></div><p>これで空のベア・リポジトリができた。
リモートから SSH 接続でリポジトリを clone するには</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">$ git clone ssh://git@sy-nas/volume1/gitrepos/hello-repos
</span></span><span class="line"><span class="cl">Cloning into &#39;hello-repos&#39;...
</span></span><span class="line"><span class="cl">warning: You appear to have cloned an empty repository.
</span></span></code></pre></div><p>とすればよい。</p>
<h2>次は Tailscale か？</h2>
<p>これは次の休みにでもやってみることにしよう。
もともと <a href="https://tailscale.com/" title="Tailscale · Best VPN Service for Secure Networks">Tailscale</a> は興味があってやってみようとは思っていたのだ。</p>
<div class="box"><strong>【2021-10-31 追記】</strong> <a href="/remark/2021/10/tailscale-with-synology-nas/">記事</a>にしました。</div>
<h2>ブックマーク</h2>
<ul>
<li><a href="https://community.synology.com/jpn/forum/2/post/6">RAIDの構成を「SHR」から「RAID 1」へ変更できますか？ | Synology Community</a></li>
<li><a href="https://news.mynavi.jp/kikaku/20181221-741225/">知らないと損! Synology社員が教えるNASの裏ワザ【前編】セキュリティーと信頼性を高める | マイナビニュース</a></li>
<li><a href="https://dc.watch.impress.co.jp/docs/review/special/1209064.html">特別企画：知っておきたい！NAS購入から活用までの疑問あれこれ - デジカメ Watch</a></li>
<li><a href="https://www.itmedia.co.jp/pcuser/articles/1603/18/news096.html">NASを使ったほうがいい人、使わないほうがいい人：Synologyで始めるNAS生活（1/3 ページ） - ITmedia PC USER</a></li>
<li><a href="https://arakoki70.com/?p=2317">Synology アカウントの取得 - アラコキからの Raspberry Pi 電子工作</a></li>
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-an-nfs-mount-on-ubuntu-20-04-ja">Ubuntu 20.04にNFSマウントをセットアップする方法 | DigitalOcean</a></li>
<li><a href="https://dc.watch.impress.co.jp/docs/review/special/1325567.html">特別企画：NASに保存した写真データを効率的に管理…「Synology Photos」先行レビュー - デジカメ Watch</a></li>
</ul>
<h2>参考</h2>
<div class="hreview">
  <div class="photo"><a href="https://www.amazon.co.jp/dp/B0855LMP81?tag=baldandersinf-22&amp;linkCode=ogi&amp;th=1&amp;psc=1"><img src="https://m.media-amazon.com/images/I/31Jy8IwFHwL._SL160_.jpg" width="160" alt="photo"></a></div>
  <dl>
    <dt class="item"><a class="fn url" href="https://www.amazon.co.jp/dp/B0855LMP81?tag=baldandersinf-22&amp;linkCode=ogi&amp;th=1&amp;psc=1">Synology NASキット 2ベイ DS220j クアッドコアCPU 512MBメモリ搭載 ライトユーザー向け 国内正規代理店品 電話サポート対応品 DiskStation</a></dt>
    <dd>Synology (Release 2020-03-12)</dd>
    <dd>Personal Computers</dd>
    <dd>B0855LMP81 (ASIN), 4537694279369 (EAN), 0846504003440 (EAN), 846504003440 (UPC)</dd>
    <dd>評価<abbr class="rating fa-sm" title="4">&nbsp;<i class="fas fa-star"></i>&nbsp;<i class="fas fa-star"></i>&nbsp;<i class="fas fa-star"></i>&nbsp;<i class="fas fa-star"></i>&nbsp;<i class="far fa-star"></i></abbr></dd>
  </dl>
  <p class="description"><a href="https://www.dospara.co.jp/">ドスパラ</a>で HDD 2基と3点セットで購入。家庭内 LAN で使うなら必要十分な性能。各種クラウド・ストレージ・サービスと連携可能。 Tailscale を含む各種 VPN と組み合わせることも可能。</p>
  <p class="powered-by">reviewed by <a href='#maker' class='reviewer'>Spiegel</a> on <abbr class="dtreviewed" title="2021-10-26">2021-10-26</abbr> (powered by <a href="https://affiliate.amazon.co.jp/assoc_credentials/home">PA-APIv5</a>)</p>
</div> <!-- Synology DS220j -->
<div class="hreview">
  <div class="photo"><a href="https://www.amazon.co.jp/dp/B08V8LNR2H?tag=baldandersinf-22&amp;linkCode=ogi&amp;th=1&amp;psc=1"><img src="https://m.media-amazon.com/images/I/41&#43;wOkdJItL._SL160_.jpg" width="160" alt="photo"></a></div>
  <dl>
    <dt class="item"><a class="fn url" href="https://www.amazon.co.jp/dp/B08V8LNR2H?tag=baldandersinf-22&amp;linkCode=ogi&amp;th=1&amp;psc=1">Western Digital ウエスタンデジタル 内蔵 HDD WD Red Plus NAS RAID (CMR) 3.5インチ WD40EFZX-EC 【国内正規代理店品】</a></dt>
    <dd>ウエスタンデジタル(Western Digital) (Release 2021-02-05)</dd>
    <dd>Personal Computers</dd>
    <dd>B08V8LNR2H (ASIN), 4988755057738 (EAN)</dd>
    <dd>評価<abbr class="rating fa-sm" title="4">&nbsp;<i class="fas fa-star"></i>&nbsp;<i class="fas fa-star"></i>&nbsp;<i class="fas fa-star"></i>&nbsp;<i class="fas fa-star"></i>&nbsp;<i class="far fa-star"></i></abbr></dd>
  </dl>
  <p class="description"><a href="https://www.synology.com/ja-jp/products/DS220j">Synology DS220j</a> と併せて購入。</p>
  <p class="powered-by">reviewed by <a href='#maker' class='reviewer'>Spiegel</a> on <abbr class="dtreviewed" title="2021-10-26">2021-10-26</abbr> (powered by <a href="https://affiliate.amazon.co.jp/assoc_credentials/home">PA-APIv5</a>)</p>
</div> <!-- HDD WD Red Plus -->
<div class="hreview">
  <div class="photo"><a href="https://www.amazon.co.jp/dp/B09GS5ZCHN?tag=baldandersinf-22&amp;linkCode=ogi&amp;th=1&amp;psc=1"><img src="https://m.media-amazon.com/images/I/51FF8hiCp8L._SL160_.jpg" width="160" alt="photo"></a></div>
  <dl>
    <dt class="item"><a class="fn url" href="https://www.amazon.co.jp/dp/B09GS5ZCHN?tag=baldandersinf-22&amp;linkCode=ogi&amp;th=1&amp;psc=1">Voice of Angel</a></dt>
    <dd>太田貴子 (メインアーティスト)</dd>
    <dd>SOLID RECORDS 2021-10-20 (Release 2021-10-20)</dd>
    <dd>MP3 ダウンロード</dd>
    <dd>B09GS5ZCHN (ASIN)</dd>
    <dd>評価<abbr class="rating fa-sm" title="5">&nbsp;<i class="fas fa-star"></i>&nbsp;<i class="fas fa-star"></i>&nbsp;<i class="fas fa-star"></i>&nbsp;<i class="fas fa-star"></i>&nbsp;<i class="fas fa-star"></i></abbr></dd>
  </dl>
  <p class="description">「太田貴子」としては31年ぶりのアルバムらしい。仕事中にヘヴィローテーションしてます。</p>
  <p class="powered-by">reviewed by <a href='#maker' class='reviewer'>Spiegel</a> on <abbr class="dtreviewed" title="2021-10-26">2021-10-26</abbr> (powered by <a href="https://affiliate.amazon.co.jp/assoc_credentials/home">PA-APIv5</a>)</p>
</div> <!-- Voice of Angel (太田貴子) -->
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>Git Server 用に作成したユーザを <code>administrators</code> グループにも所属させて管理者権限を付与すること。&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p>複数ユーザで Git Server にアクセスしたいなら <code>.ssh/authorized_keys</code> ファイルに必要な数だけ公開鍵を登録する。&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>

</div></section>

</article>
</main>
<nav class="page-nav">
<div class="prev-page">&laquo; <a href="/remark/2021/10/toughness-of-system/">人の靭性</a></div>
<div class="next-page"><a href="/remark/2021/10/tailscale-with-synology-nas/">Synology NAS に Tailscale を設定する</a> &raquo;</div>
</nav>

<aside class="feedback" id='feedback'>
<h1>Feedback</h1>
<p>GitHub に<a href="https://github.com/spiegel-im-spiegel/github-pages-env/discussions">フィードバック用のディスカッションページ</a>を用意しました。
書き込みには GitHub のアカウントが必要ですが，お気軽にご利用ください。</p>
<p>他のフィードバック手段として Mastodon などの SNS や電子メールも利用できます。電子メールを利用する際の公開鍵は<a href="https://baldanders.info/profile/">プロフィール</a>から取得できます。</p>
</aside>
<footer>


<div class="userinfo">
	<div class="userinfo-avater">
		<a href="https://baldanders.info/profile/"><img src="https://text.baldanders.info/images/avatar.jpg" width="48" height="48" alt="avatar" id="logo"></a>
	</div>
	<div class="userinfo-info" id="maker">
		Text by <a href="https://baldanders.info/profile/" rel="cc:attributionURL" property="cc:attributionName">Spiegel</a>
		in <time property='dc:dateCopyrighted'>2021-10-26</time> (revised in 2021-11-14)
		<a rel='cc:license' href="https://creativecommons.org/licenses/by-sa/4.0/"><i class="fab fa-creative-commons"></i>&nbsp;<i class="fab fa-creative-commons-by"></i>&nbsp;<i class="fab fa-creative-commons-sa"></i></a>
		<ul class="social"><li><a rel="me" href="https://github.com/spiegel-im-spiegel"><span class="github-color"><abbr title="GitHub"><i class="fab fa-github"></i></abbr></span></a></li><li><a rel="me" href="https://www.flickr.com/photos/spiegel/"><span class="flickr-color"><abbr title="Flickr"><i class="fab fa-flickr"></i></abbr></span></a></li><li><a rel="me" href="https://fedibird.com/@spiegel"><span class="mastodon-color"><abbr title="Mastodon"><i class="fa-brands fa-mastodon"></i></abbr></span></a></li><li><a rel="me" href="https://bsky.app/profile/baldanders.info"><abbr class="emoji-chars" title="Bluesky">🦋</abbr></a></li></ul>
	</div>
</div>

<nav>
<ul class='cloud center'>
<li><a href='/about-feeds/'>Feeds</a></li>
<li><a href='/reviews/'>Reviews</a></li>
<li><a href='/site-policy/'>Policy</a></li>
<li><a href='https://github.com/spiegel-im-spiegel/spiegel-im-spiegel.github.io'>Repository</a></li>
<li><a href='https://validator.w3.org/nu/?doc=https%3a%2f%2ftext.baldanders.info%2fremark%2f2021%2f10%2fnas%2f&amp;showoutline=yes'>Debug</a></li>
</ul>
<ul class='cloud center'>
<li><a href='https://baldanders.info/'>Home</a></li>
<li><a href='https://photo.baldanders.info/'>Photos</a></li>
<li><a href='https://slide.baldanders.info/'>Slide</a></li>
<li><a href='https://zenn.dev/spiegel'>Zenn</a></li>
</ul>
<ul class='cloud center'>
<li>Powered by <a href='https://gohugo.io/'>Hugo 0.121.2</a> and <a href="https://github.com/spiegel-im-spiegel/hugo-theme-baldanders-info
">Theme of Baldanders.info</a>.</li>
</ul>
</nav>
</footer>
</div>

</body>
</html>
