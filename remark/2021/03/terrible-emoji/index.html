<!DOCTYPE html>
<html lang="ja">
<head prefix="og: http://ogp.me/ns#">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="generator" content="Hugo 0.156.0">
<link rel="icon" type="image/x-icon" href="/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
<link rel="apple-touch-icon" type="image/png" sizes="144x144" href="/apple-icon-144x144.png">
<link rel="icon" type="image/png" sizes="192x192"  href="/android-icon-192x192.png">
<link rel="manifest" href="/manifest.json">
<link rel="canonical" href="https://text.baldanders.info/remark/2021/03/terrible-emoji/">
<script defer src="/fa/js/all.min.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=BIZ+UDGothic:wght@400;700&family=BIZ+UDMincho:wght@400;700&family=Intel+One+Mono:wght@400;700&family=Noto+Color+Emoji&family=Noto+Sans:wght@400;700&family=Noto+Serif+Hentaigana:wght@400;700&family=Noto+Serif:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="/css/local-font.css" type='text/css'>
<link rel="stylesheet" href="/css/baldanders-info-dark.css" type='text/css'>

<link rel="alternate" href="https://text.baldanders.info/index.xml" type="application/rss+xml" title="text.Baldanders.info">
<link rel="alternate" href="https://text.baldanders.info/index.json" type="application/json" title="text.Baldanders.info">
<meta name="google-site-verification" content="jTjBCslPtf8gwVatiY-GDgGv7pV5csa8aUOw1MRPUD4">
<link rel="me" href="https://fedibird.com/@spiegel">
<title>おそるべき絵文字 [text.Baldanders.info]</title>
<meta property="og:title" content="おそるべき絵文字">
<meta name="description" content="なんでこんなカオスになっちゃったのかねぇ。">
<meta property="og:description" content="なんでこんなカオスになっちゃったのかねぇ。">
<meta property="og:image" content="https://text.baldanders.info/images/attention/kitten.jpg">
<meta name="author" content="Spiegel">


<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@spiegel_2007">
<meta name="twitter:creator" content="@spiegel_2007">
<link rel="me" href="https://goark.fedicity.net/@spiegel">
<meta name="keywords" content="character, unicode, engineering, emoji">
<link rel='prev' href='https://text.baldanders.info/remark/2021/03/google-vs-oracle-3/' title='Google vs Oracle の訴訟の行方 3'>
<link rel='next' href='https://text.baldanders.info/remark/2021/04/emoji-list/' title='「情報交換用に推奨される絵文字のリスト」を作ってみた'>

<script type="application/ld+json">
{
	"@context": "http://schema.org",
	"@type": "WebSite",
	"@id": "https://text.baldanders.info/",
	"inLanguage": "ja",
	"name": "text.Baldanders.info",
    "url": "https://text.baldanders.info/",
	"publisher": {
		"@id": "https://text.baldanders.info/#org"
	},
	"author": {
		"@id": "https://text.baldanders.info/#maker"
	},
	"image": "https://text.baldanders.info/images/attention/site.jpg",
	"description": "帰ってきた「しっぽのさきっちょ」"
}
</script>
<script type="application/ld+json">
{
	"@context": "http://schema.org",
	"@type": "Organization",
	"@id": "https://text.baldanders.info/#org",
	"name": "Spiegel",
	"logo": {
		"@type": "ImageObject",
		"@id": "https://text.baldanders.info/#logo",
		"url": "https://text.baldanders.info/images/avatar.jpg"
	}
}
</script>
<script type="application/ld+json">
{
	"@context": "http://schema.org",
	"@type": "Person",
	"@id": "https://text.baldanders.info/#maker",
	"name": "Spiegel",
	"url": "https://baldanders.info/profile/",
	"image": "https://text.baldanders.info/images/avatar.jpg"
}
</script>
<script type="application/ld+json">
{
	"@context": "http://schema.org",
	"@type": "Blog",
	"@id": "https://text.baldanders.info/remark/",
	"url": "https://text.baldanders.info/remark/",
	"inLanguage": "ja",
	"name": "しっぽのさきっちょ",
	"description": "帰ってきた「しっぽのさきっちょ」。とりとめのない四方山話。",
	"image": "https://text.baldanders.info/images/attention/remark.jpg",
	"publisher": {
		"@id": "https://text.baldanders.info/#org"
	},
	"author": {
		"@id": "https://text.baldanders.info/#maker"
	}
}
</script>
<script type="application/ld+json">
{
	"@context": "http://schema.org",
	"@type": "BreadcrumbList",
	"@id": "https://text.baldanders.info/remark/2021/03/terrible-emoji/#breadcrumb-list",
	"itemListElement": [
		{
			"@type": "ListItem",
			"position": 1,
			"item": {
				"@id": "https://text.baldanders.info/"
			}
		},
		{
			"@type": "ListItem",
			"position": 2,
			"item": {
				"@id": "https://text.baldanders.info/remark/"
			}
		}
	]
}
</script>
<script type="application/ld+json">
{
	"@context": "http://schema.org",
	"@type": "BlogPosting",
	"@id": "https://text.baldanders.info/remark/2021/03/terrible-emoji/",
	"url": "https://text.baldanders.info/remark/2021/03/terrible-emoji/",
	"mainEntityOfPage": "https://text.baldanders.info/remark/2021/03/terrible-emoji/",
	"inLanguage": "ja",
	"name": "おそるべき絵文字",
	"description": "なんでこんなカオスになっちゃったのかねぇ。",
	"headline": "なんでこんなカオスになっちゃったのかねぇ。",
	"keywords": "character, unicode, engineering, emoji",
	"image": "https://text.baldanders.info/images/attention/kitten.jpg",
	"datePublished": "2021-03-30T10:58:27+00:00",
	"dateModified": "2021-12-04T02:40:05+00:00",
	"publisher": {
		"@id": "https://text.baldanders.info/#org"
	},
	"author": {
		"@id": "https://text.baldanders.info/#maker"
	},
	"license": "https://creativecommons.org/licenses/by-sa/4.0/"
}
</script>
</head>
<body>

<div id='container'>

<main>
<nav class="breadcrumb">
<a href="https://text.baldanders.info/">text.Baldanders.info</a> &raquo; <a href="/remark/">しっぽのさきっちょ</a>
</nav>
<article>
<h1>おそるべき絵文字</h1>
<nav class="tags">
	<div><a href='/tags/'>Tags</a>: #<a href="/tags/character/">character</a> #<a href="/tags/emoji/">emoji</a> #<a href="/tags/engineering/">engineering</a> #<a href="/tags/unicode/">unicode</a></div>
	<div class="cloud">
		<span class="share-color" title="Share this entry"><i class="fa-solid fa-share-from-square"></i></span>&nbsp;:
		&nbsp;<a href="https://getpocket.com/edit?url=https%3a%2f%2ftext.baldanders.info%2fremark%2f2021%2f03%2fterrible-emoji%2f&amp;title=%e3%81%8a%e3%81%9d%e3%82%8b%e3%81%b9%e3%81%8d%e7%b5%b5%e6%96%87%e5%ad%97" target="_blank"><span class="pocket-color"><abbr title="Share Pocket"><i class="fab fa-get-pocket" aria-hidden="true"></i></abbr></span></a>
		&nbsp;<a href="http://www.facebook.com/share.php?u=https%3a%2f%2ftext.baldanders.info%2fremark%2f2021%2f03%2fterrible-emoji%2f" target="_blank"><span class="facebook-color"><abbr title="Share facebook"><i class="fab fa-square-facebook" aria-hidden="true"></i></abbr></span></a>
		&nbsp;<a href="http://x.com/intent/post?text=%e3%81%8a%e3%81%9d%e3%82%8b%e3%81%b9%e3%81%8d%e7%b5%b5%e6%96%87%e5%ad%97+by+@spiegel_2007&amp;url=https%3a%2f%2ftext.baldanders.info%2fremark%2f2021%2f03%2fterrible-emoji%2f" target="_blank"><span class="x-twitter-color"><abbr title="Share Twitter"><i class="fa-brands fa-square-x-twitter" aria-hidden="true"></i></abbr></span></a>
		&nbsp;<a href="https://donshare.net/share.html?text=%e3%81%8a%e3%81%9d%e3%82%8b%e3%81%b9%e3%81%8d%e7%b5%b5%e6%96%87%e5%ad%97+by+@spiegel%40goark.fedicity.net%20+https%3a%2f%2ftext.baldanders.info%2fremark%2f2021%2f03%2fterrible-emoji%2f" target="_blank"><span class="mastodon-color"><abbr title="Share Mastodon"><i class="fa-brands fa-mastodon" aria-hidden="true"></i></abbr></span></a>
	</div>
</nav>
<nav class="history">History in
  <a href="https://github.com/spiegel-im-spiegel/spiegel-im-spiegel.github.io/commits/master/remark/2021/03/terrible-emoji/index.html">GitHub Page</a>
</nav>

<section><div>
<div class="noextension">
<a href="https://baldanders.info/public-domain-locked/" title="Public Domain Locked... | Baldanders.info"><img src="/images/Locked-150.png" alt="no extension" width="150"></a>
</div>
<p>きっかけは以下の tweet:</p>
<figure style='margin:0 auto;text-align:center;'><div class="nobox">
<blockquote class="twitter-tweet"><p lang="ja" dir="ltr">ほら <a href="https://twitter.com/hashtag/golang?src=hash&amp;ref_src=twsrc%5Etfw">#golang</a> ならこんなに簡単に絵文字を取り除けますよ！8ビット単位だとややこしい書き方が必要になっちゃう。<a href="https://t.co/AiELa8RlvS">https://t.co/AiELa8RlvS</a></p>&mdash; のぼのぼ📡 (@nobonobo) <a href="https://twitter.com/nobonobo/status/1376186097881866240?ref_src=twsrc%5Etfw">March 28, 2021</a></blockquote>
</div></figure>
<p>この tweet の元ネタである「<a href="https://twitter.com/c_shii41/status/1376163845647986688">Go言語の正規表現regexpが遅すぎる</a>」というのは概ねその通りで，私も<a href="https://text.baldanders.info/golang/regular-expression/" title="正規表現に関する戯れ言">記事で書いた</a> が，これはそもそも <a href="https://golang.org/pkg/regexp/" title="regexp - The Go Programming Language"><code>regexp</code></a> パッケージの設計方針が</p>
<figure lang="en">
<blockquote cite="https://golang.org/pkg/regexp/"><q>The regexp implementation provided by this package is guaranteed to run in time linear in the size of the input</q>.</blockquote>
<figcaption><div>via <q><a href="https://golang.org/pkg/regexp/">regexp - The Go Programming Language</a></q></div></figcaption>
</figure>
<p>となっているためで，「遅くなりすぎない」ことのトレードオフとして（Ruby や Perl などと比べて）全体的に遅いのである<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>。</p>
<p>ただ，<a href="https://play.golang.org/p/brhrHn6dm3A">サンプルコード</a>にある</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">var</span><span class="w"> </span><span class="nx">emojiRegex</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">regexp</span><span class="p">.</span><span class="nf">MustCompile</span><span class="p">(</span><span class="s">&#34;[\U0001f000-\U0001ffff]&#34;</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></div><p>という正規表現はさすがに端折りすぎで，つい「<a href="https://twitter.com/spiegel_2007/status/1376301767411990529">そんな単純じゃねーよ</a>」と脊髄反射してしまったのは許してほしい。</p>
<p>でも，よく考えたら，ここのブログや <a href="https://zenn.dev/" title="Zenn｜エンジニアのための情報共有コミュニティ">Zenn</a> でも絵文字の話をよく書くようになったが，まとまった記事としては書いてない。
というわけで，この記事である程度まとめてみたいと思う。</p>
<p>以上，前説おわり。</p>
<h2>Unicode は1コード＝1文字じゃない</h2>
<p>まず大前提として Unicode は1コード＝1文字じゃない。
これは日本語圏で苦労している私たちには自明だと思うが，たとえば「ペンギン」という単語にしたって</p>
<ul>
<li>ペ：<code>U+30D8</code> + <code>U+309A</code></li>
<li>ン：<code>U+30F3</code></li>
<li>ギ：<code>U+30AD</code> + <code>U+3099</code></li>
<li>ン：<code>U+30F3</code></li>
</ul>
<p>と<a href="https://text.baldanders.info/golang/unicode-normalization/" title="Go 言語と Unicode 正規化">濁点・半濁点が分離している場合がある</a> 。
これは絵文字でも同様で，たとえば「土下座する男性 <abbr class="emoji-chars" title=":bowing_man:">🙇‍♂️</abbr>」を拙作の <a href="https://github.com/spiegel-im-spiegel/gnkf" title="spiegel-im-spiegel/gnkf: Network Kanji Filter by Golang">gnkf</a> を使って Unicode 符号点（code point）に分解すると</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">$ echo 🙇‍♂️ | gnkf dump --unicode
</span></span><span class="line"><span class="cl">0x0001f647, 0x200d, 0x2642, 0xfe0f, 0x000a
</span></span></code></pre></div><p>と，4つの符号点の合成列として構成されているのが分かる。
ちなみに各符号点の内容は</p>
<table>
  <thead>
      <tr>
          <th>符号点</th>
          <th style="text-align: center">字形</th>
          <th>名称</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>U+1F647</code></td>
          <td style="text-align: center"><abbr class="emoji-chars" title=":person_bowing:">🙇</abbr></td>
          <td>PERSON BOWING DEEPLY</td>
      </tr>
      <tr>
          <td><code>U+200D</code></td>
          <td style="text-align: center"></td>
          <td>ZERO WIDTH JOINER</td>
      </tr>
      <tr>
          <td><code>U+2642</code></td>
          <td style="text-align: center">♂</td>
          <td>MALE SIGN</td>
      </tr>
      <tr>
          <td><code>U+FE0F</code></td>
          <td style="text-align: center"></td>
          <td>VARIATION SELECTOR-16</td>
      </tr>
  </tbody>
</table>
<p>となっている。
これだけ見ても，絵文字を</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">var</span><span class="w"> </span><span class="nx">emojiRegex</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">regexp</span><span class="p">.</span><span class="nf">MustCompile</span><span class="p">(</span><span class="s">&#34;[\U0001f000-\U0001ffff]&#34;</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></div><p>などと安直に括り出すのが如何にヤバいか分かるであろう。</p>
<p>Unicode 文字列中の「文字」を真面目に分解して取り扱いたいなら，たとえば <a href="https://go.dev/">Go</a> 言語なら <code>rune</code> ではなく <code>[]rune</code> のように符号点の可変配列として取り扱う必要があるだろう。
かつ，各符号点の意味を考えながら「どこまでが1文字か」を解析するロジックが必要になる。</p>
<p>ちなみに <a href="https://go.dev/">Go</a> では <a href="https://github.com/rivo/uniseg" title="rivo/uniseg: Unicode Text Segmentation for Go (or: How to Count Characters in a String)">rivo/uniseg</a> パッケージを使うといい感じに分解してくれるらしい。</p>
<h2>符号とフォントと入出力</h2>
<p>これも言ってしまえば当たり前のことなのだが，絵文字は符号とフォントと入出力が揃ってはじめて絵文字として機能する。
先ほどの <abbr class="emoji-chars" title=":bowing_man:">🙇‍♂️</abbr> も</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">$ echo 🙇‍♂️ | gnkf dump --unicode
</span></span><span class="line"><span class="cl">0x0001f647, 0x200d, 0x2642, 0xfe0f, 0x000a
</span></span></code></pre></div><p>という符号点の並びがひとつの絵文字であると解釈し，かつその文字に対応するフォントとグリフがあり，さらにそのグリフで表示できるアプリケーションがあってはじめて <abbr class="emoji-chars" title=":bowing_man:">🙇‍♂️</abbr> と表示できる。</p>
<p>この記事中の絵文字も，もしかしたらブラウザの種類やバージョン等によって 🙇♂ と2文字に見えているかもしれない。
もしくは変な記号に「文字化け」するとか，そもそも全く表示されないとか&hellip;</p>
<p>たとえば Twitter ではユーザ側の環境やアプリケーション間の差異を軽減するため，絵文字を独自の画像データに置き換えるツールキットを公開している。</p>
<ul>
<li><a href="https://twemoji.twitter.com/">Twemoji</a></li>
</ul>
<p><a href="https://zenn.dev/" title="Zenn｜エンジニアのための情報共有コミュニティ">Zenn</a> のアテンション用絵文字もこれを使って表示している筈。</p>
<p>それぞれの絵文字がどのように表示されるか（または表示されないか）については Unicode 公式ページにある</p>
<ul>
<li><a href="https://unicode.org/emoji/charts/full-emoji-list.html">Full Emoji List</a></li>
</ul>
<p>が参考になるだろう。
2021年3月時点の最新版である v13.1 では1,816個の絵文字が定義されている。</p>
<p>多いよ <code>orz</code></p>
<h3>ターミナル・エミュレータと絵文字</h3>
<p>ブラウザとかスマホ・アプリならまだマシだと思うが， CUI ベースのターミナル・エミュレータは絵文字周りが特に冷遇されている印象がある。</p>
<p>私は CLI ツールで対話モードを組むときに <a href="https://github.com/nyaosorg/go-readline-ny" title="nyaosorg/go-readline-ny: Readline library for golang , used in nyagos">nyaosorg/go-readline-ny</a> パッケージ<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup> のお世話になるのだが，<a href="https://github.com/nyaosorg/go-readline-ny/releases" title="Releases · nyaosorg/go-readline-ny">リリース情報</a>を見るとホンマに絵文字で苦労されているのが分かる。
その一端が以下の <a href="https://zenn.dev/" title="Zenn｜エンジニアのための情報共有コミュニティ">Zenn</a> 本に記されているので，是非ご覧あれ。</p>
<ul>
<li><a href="https://zenn.dev/zetamatta/books/b820d588f4856bcf836c">Windows と Unicode とボク</a></li>
</ul>
<p>プログラマが読んだら涙で前が見えなくなるよ（笑）</p>
<h2>“#” の Keycap はあるのに “A” の Keycap はないのか</h2>
<p>上で紹介した “<a href="https://unicode.org/emoji/charts/full-emoji-list.html">Full Emoji List</a>” を眺めると，たとえば絵文字 <abbr class="emoji-chars" title=":keycap_#:">#️⃣</abbr> は</p>
<table>
  <thead>
      <tr>
          <th>符号点</th>
          <th style="text-align: center">字形</th>
          <th>名称</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>U+0023</code></td>
          <td style="text-align: center"><code>#</code></td>
          <td>NUMBER SIGN</td>
      </tr>
      <tr>
          <td><code>U+FE0F</code></td>
          <td style="text-align: center"></td>
          <td>VARIATION SELECTOR-16</td>
      </tr>
      <tr>
          <td><code>U+20E3</code></td>
          <td style="text-align: center"><code> ⃣</code></td>
          <td>COMBINING ENCLOSING KEYCAP</td>
      </tr>
  </tbody>
</table>
<p>という並びになっている。
もう</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">var</span><span class="w"> </span><span class="nx">emojiRegex</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">regexp</span><span class="p">.</span><span class="nf">MustCompile</span><span class="p">(</span><span class="s">&#34;[\U0001f000-\U0001ffff]&#34;</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></div><p>という正規表現に微塵もかからない（笑）</p>
<p>いや，そうじゃなくて。
たしかに普通の半角記号である <code>#</code> が合成列の先頭に来ているのも驚きだが，その直後に絵文字用の異体字セレクタが来ているのにビックリした。
必ずしも異体字セレクタが最後に付くんじゃないのか。</p>
<p>まぁ，でも意味は分かる。
<abbr class="emoji-chars" title=":keycap_#:">#️⃣</abbr> は <code>#</code> 記号の絵文字異体字ってことで，先頭の符号点だけ見れば <code>#</code> と等価な文字として扱えるってことだよね。
そしてその後ろに keycap を表す結合文字がくっ付いている，と。</p>
<p>そんじゃあ <code>#</code> の代わりに <code>A</code> とかの任意の文字でも keycap の絵文字が作れるんじゃね？ と一瞬思ったが “<a href="https://unicode.org/emoji/charts/full-emoji-list.html">Full Emoji List</a>” を見る限りそんなことはないようだ<sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup>。</p>
<p>どういうルールなんだろうねぇ。</p>
<h2>肌色の異体字</h2>
<p>最初に紹介した “PERSON BOWING DEEPLY” <abbr class="emoji-chars" title=":person_bowing:">🙇</abbr> には肌色の情報をくっ付けることができる。</p>
<p>こんな感じ。</p>
<table>
  <thead>
      <tr>
          <th>合成列</th>
          <th style="text-align: center">字形</th>
          <th>名称</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>U+1F647</code> + <code>U+1F3FB</code></td>
          <td style="text-align: center"><abbr class="emoji-chars" title=":person_bowing_tone1:">🙇🏻</abbr></td>
          <td>person bowing: light skin tone</td>
      </tr>
      <tr>
          <td><code>U+1F647</code> + <code>U+1F3FC</code></td>
          <td style="text-align: center"><abbr class="emoji-chars" title=":person_bowing_tone2:">🙇🏼</abbr></td>
          <td>person bowing: medium-light skin tone</td>
      </tr>
      <tr>
          <td><code>U+1F647</code> + <code>U+1F3FD</code></td>
          <td style="text-align: center"><abbr class="emoji-chars" title=":person_bowing_tone3:">🙇🏽</abbr></td>
          <td>person bowing: medium skin tone</td>
      </tr>
      <tr>
          <td><code>U+1F647</code> + <code>U+1F3FE</code></td>
          <td style="text-align: center"><abbr class="emoji-chars" title=":person_bowing_tone4:">🙇🏾</abbr></td>
          <td>person bowing: medium-dark skin tone</td>
      </tr>
      <tr>
          <td><code>U+1F647</code> + <code>U+1F3FF</code></td>
          <td style="text-align: center"><abbr class="emoji-chars" title=":person_bowing_tone5:">🙇🏿</abbr></td>
          <td>person bowing: dark skin tone</td>
      </tr>
  </tbody>
</table>
<p>この肌色って人種を指すものじゃなくて “<a href="https://en.wikipedia.org/wiki/Fitzpatrick_scale" title="Fitzpatrick scale - Wikipedia">fitzpatrick skin typing</a>” と呼ばれる紫外線への感受性を基にした分類らしい。</p>
<table>
  <thead>
      <tr>
          <th>符号点</th>
          <th>名称</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>U+1F3FB</code></td>
          <td>EMOJI MODIFIER FITZPATRICK TYPE-1-2</td>
      </tr>
      <tr>
          <td><code>U+1F3FC</code></td>
          <td>EMOJI MODIFIER FITZPATRICK TYPE-3</td>
      </tr>
      <tr>
          <td><code>U+1F3FD</code></td>
          <td>EMOJI MODIFIER FITZPATRICK TYPE-4</td>
      </tr>
      <tr>
          <td><code>U+1F3FE</code></td>
          <td>EMOJI MODIFIER FITZPATRICK TYPE-5</td>
      </tr>
      <tr>
          <td><code>U+1F3FF</code></td>
          <td>EMOJI MODIFIER FITZPATRICK TYPE-6</td>
      </tr>
  </tbody>
</table>
<p>このコードは結合文字の一種のように見えるが，どんな絵文字にもくっ付くわけではないらしい。
有効な組み合わせは</p>
<ul>
<li><a href="https://www.unicode.org/emoji/charts/full-emoji-modifiers.html">Full Emoji Modifier Sequences</a></li>
</ul>
<p>を参考にするといいだろう。</p>
<h2>ZWJ による絵文字の合成</h2>
<p>最初の「土下座する男性 <abbr class="emoji-chars" title=":bowing_man:">🙇‍♂️</abbr>」に戻る。
男性があるのだから女性バージョン <abbr class="emoji-chars" title=":bowing_woman:">🙇‍♀️</abbr> も当然ある。</p>
<p><abbr class="emoji-chars" title=":bowing_woman:">🙇‍♀️</abbr> の内容は以下の通り。</p>
<table>
  <thead>
      <tr>
          <th>符号点</th>
          <th style="text-align: center">字形</th>
          <th>名称</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>U+1F647</code></td>
          <td style="text-align: center"><abbr class="emoji-chars" title=":person_bowing:">🙇</abbr></td>
          <td>PERSON BOWING DEEPLY</td>
      </tr>
      <tr>
          <td><code>U+200D</code></td>
          <td style="text-align: center"></td>
          <td>ZERO WIDTH JOINER</td>
      </tr>
      <tr>
          <td><code>U+2640</code></td>
          <td style="text-align: center">♀</td>
          <td>FEMALE SIGN</td>
      </tr>
      <tr>
          <td><code>U+FE0F</code></td>
          <td style="text-align: center"></td>
          <td>VARIATION SELECTOR-16</td>
      </tr>
  </tbody>
</table>
<p>つまり “PERSON BOWING DEEPLY” に性差を示す “MALE SIGN” または “FEMALE SIGN” を “ZERO WIDTH JOINER” (ZWJ) を介してくっ付けることで異体字を構成している。</p>
<p>このように ZWJ を使って文字をくっ付けて異体字や新たな絵文字を作る方法にはかなりのバリエーションがあるようだが，どうもプラットフォームごとに勝手にコードを組み合わせているらしく上手く表示できないパターンがあるようだ。</p>
<p>このため <a href="https://zenn.dev/" title="Zenn｜エンジニアのための情報共有コミュニティ">Zenn</a> では，以下のリストにない絵文字を排除することで<a href="https://github.com/zenn-dev/zenn-roadmap/issues/224#issuecomment-767231796">対応</a>しているそうだ。</p>
<ul>
<li><a href="https://www.unicode.org/emoji/charts/emoji-zwj-sequences.html">Recommended Emoji ZWJ Sequences</a></li>
</ul>
<p>この一覧によると “PERSON BOWING DEEPLY” <abbr class="emoji-chars" title=":person_bowing:">🙇</abbr> には，前節の肌色バリエーションと男女性差のバリエーションを組み合わせて，合計10個の異体字がある，ということになる。</p>
<h2>国旗絵文字</h2>
<p>個人的にこれが一番ワケワカメ。</p>
<p>REGIONAL INDICATOR なるコードがあって</p>
<table>
  <thead>
      <tr>
          <th>符号点</th>
          <th style="text-align: center">字形</th>
          <th>名称</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>U+1F1E6</code></td>
          <td style="text-align: center">🇦</td>
          <td>REGIONAL INDICATOR SYMBOL LETTER A</td>
      </tr>
      <tr>
          <td><code>U+1F1E7</code></td>
          <td style="text-align: center">🇧</td>
          <td>REGIONAL INDICATOR SYMBOL LETTER B</td>
      </tr>
      <tr>
          <td><code>U+1F1E8</code></td>
          <td style="text-align: center">🇨</td>
          <td>REGIONAL INDICATOR SYMBOL LETTER C</td>
      </tr>
      <tr>
          <td>&hellip;</td>
          <td style="text-align: center">&hellip;</td>
          <td>&hellip;</td>
      </tr>
      <tr>
          <td><code>U+1F1EF</code></td>
          <td style="text-align: center">🇯</td>
          <td>REGIONAL INDICATOR SYMBOL LETTER J</td>
      </tr>
      <tr>
          <td>&hellip;</td>
          <td style="text-align: center">&hellip;</td>
          <td>&hellip;</td>
      </tr>
      <tr>
          <td><code>U+1F1F5</code></td>
          <td style="text-align: center">🇵</td>
          <td>REGIONAL INDICATOR SYMBOL LETTER P</td>
      </tr>
      <tr>
          <td>&hellip;</td>
          <td style="text-align: center">&hellip;</td>
          <td>&hellip;</td>
      </tr>
      <tr>
          <td><code>U+1F1FF</code></td>
          <td style="text-align: center">🇿</td>
          <td>REGIONAL INDICATOR SYMBOL LETTER Z</td>
      </tr>
  </tbody>
</table>
<p>これを使って ISO 3166 (日本では JIS X 0304) の国別コードを組むと国旗の絵文字になるらしい。
日本の国別コードは JP なので</p>
<table>
  <thead>
      <tr>
          <th>合成列</th>
          <th style="text-align: center">字形</th>
          <th>名称</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>U+1F1EF</code> + <code>U+1F1F5</code></td>
          <td style="text-align: center"><abbr class="emoji-chars" title=":flag_jp:">🇯🇵</abbr></td>
          <td>flag: Japan</td>
      </tr>
  </tbody>
</table>
<p>となる。</p>
<p>ところでこれ，ちゃんと国旗に見えてます？ かなり環境依存度が大きいようで Windows とかでは軒並みアウトっぽい。</p>
<p>さらにアレなのが Unicode 10.0 で追加された <a href="https://emojipedia.org/emoji-tag-sequence/" title="🏴󠁧󠁢󠁳󠁣󠁴󠁿 Emoji Tag Sequences for Subdivision Flags">subdivision-flag</a> に分類されているもので，たとえば「イングランドの国旗 <abbr class="emoji-chars" title=":flag_England:">🏴󠁧󠁢󠁥󠁮󠁧󠁿</abbr>」は</p>
<table>
  <thead>
      <tr>
          <th>符号点</th>
          <th style="text-align: center">字形</th>
          <th>名称</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>U+x1F3F4</code></td>
          <td style="text-align: center">🏴</td>
          <td>WAVING BLACK FLAG</td>
      </tr>
      <tr>
          <td><code>U+E0067</code></td>
          <td style="text-align: center"></td>
          <td>TAG LATIN SMALL LETTER G</td>
      </tr>
      <tr>
          <td><code>U+E0062</code></td>
          <td style="text-align: center"></td>
          <td>TAG LATIN SMALL LETTER B</td>
      </tr>
      <tr>
          <td><code>U+E0065</code></td>
          <td style="text-align: center"></td>
          <td>TAG LATIN SMALL LETTER E</td>
      </tr>
      <tr>
          <td><code>U+E006E</code></td>
          <td style="text-align: center"></td>
          <td>TAG LATIN SMALL LETTER N</td>
      </tr>
      <tr>
          <td><code>U+E0067</code></td>
          <td style="text-align: center"></td>
          <td>TAG LATIN SMALL LETTER G</td>
      </tr>
      <tr>
          <td><code>U+E007F</code></td>
          <td style="text-align: center"></td>
          <td>CANCEL TAG</td>
      </tr>
  </tbody>
</table>
<p>という並びになっている。
一般的には “WAVING BLACK FLAG” と “CANCEL TAG” の間に TAG LATIN SMALL LETTER A～Z (<code>U+E0061</code> ～ <code>U+E007A</code>) を5つ並べる構成になっているらしい。</p>
<p>なにその面倒くさいやつ。</p>
<h2>絵文字シーケンスのまとめ</h2>
<p>以上をまとめると，絵文字の分類は以下のようになっているらしい（「<a href="https://qiita.com/_sobataro/items/47989ee4b573e0c2adfc" title="Unicode 絵文字にまつわるあれこれ (絵文字の標準とプログラム上でのハンドリング) - Qiita">Unicode 絵文字にまつわるあれこれ</a>」を参考に分類）。</p>
<ul>
<li>singleton ： 単体のコードポイントからなる絵文字</li>
<li>emoji sequence ： 複数のコードポイントからなる絵文字
<ul>
<li>emoji core sequence ： 通常の絵文字
<ul>
<li>emoji combining sequence ： 囲み文字</li>
<li>emoji modifier sequence ： skin tone 絵文字</li>
<li>emoji flag sequence ： 国旗絵文字</li>
</ul>
</li>
<li>emoji zwj sequence ： 家族絵文字、職業絵文字など</li>
<li>emoji tag sequence ：タグ絵文字</li>
</ul>
</li>
</ul>
<p>この分類でいくと Keycap の絵文字は “emoji combining sequence” に相当する。
肌色の異体字は “emoji modifier sequence” やね。
ZWJ にとる文字の結合は “emoji zwj sequence” で，国旗絵文字はそのまま “emoji flag sequence”。
ただし subdivision-flag は “emoji tag sequence” に分類されるようだ。</p>
<p>しかもこれってただの分類なので，実際の絵文字がどれに分類されるかは「知識」としてあらかじめ知ってないといけない。
プログラマ的に言うならロジックを書くだけでは足りなくてロジックを駆動する知識をデータベースとして何処かに保持っておく必要がある。</p>
<p>なんでこんなカオスになっちゃったのかねぇ。
本当に「おそるべき絵文字」だよ。</p>
<h2>【余談】元号記号も絵文字と見做せばいいぢゃん</h2>
<p>絵文字を調べてて思い出したのが，4年前に書いた</p>
<ul>
<li><a href="https://text.baldanders.info/remark/2017/12/character-of-the-new-era-name/">新元号「文字」という技術的負債</a></li>
</ul>
<p>という記事。
「<a href="https://text.baldanders.info/remark/2020/12/technical-debt-and-hacker/" title="技術的負債とハッカー">技術的負債</a>」と口走ったのは私の黒歴史としてスルーしていただけるとありがたいが，よく考えたら「㍻ <code>U+337B</code>」とかを「文字」だと思うから不合理に感じるのであって「絵文字」と思えばアリなのか。
いや， Unicode では絵文字と定義しているわけじゃないけど。</p>
<p>でも「<abbr class="emoji-chars" title=":copyright:">©️</abbr> <code>U+00A9</code>」だって絵文字扱いなんだから ㍻ も絵文字でいいよね（笑）</p>
<h2>ブックマーク</h2>
<p>Unicode における「絵文字」黎明期の話は，<a href="https://ogwata.hatenadiary.org/" title="もじのなまえ">小形克宏</a>さんの一連の記事が参考になる。</p>
<ul>
<li><a href="https://japan.cnet.com/article/20389042/">絵文字が開いてしまった「パンドラの箱」第1回&ndash;日本の携帯電話キャリアが選んだ道 - CNET Japan</a></li>
<li><a href="https://japan.cnet.com/article/20389453/">絵文字が開いてしまった「パンドラの箱」第2回&ndash;Googleの開けてしまった箱の中味 - CNET Japan</a></li>
<li><a href="https://japan.cnet.com/article/20390204/">絵文字が開いてしまった「パンドラの箱」第3回&ndash;Unicode提案の限界とメリット - CNET Japan</a></li>
<li><a href="https://japan.cnet.com/article/20394318/">絵文字が開いてしまった「パンドラの箱」第4回&ndash;絵文字が引き起こしたUnicode-MLの“祭り” - CNET Japan</a></li>
<li><a href="https://japan.cnet.com/article/20398174/">絵文字が開いてしまった「パンドラの箱」第5回&ndash;絵文字と日本マンガの親密な関係 - CNET Japan</a></li>
<li><a href="https://japan.cnet.com/article/20407674/">絵文字が開いてしまった「パンドラの箱」第6回&ndash;Google・Apple提案とそのシナリオ - CNET Japan</a></li>
<li><a href="https://japan.cnet.com/article/20407951/">絵文字が開いてしまった「パンドラの箱」第7回&ndash;そして舞台はダブリンから東京へ - CNET Japan</a></li>
<li><a href="https://japan.cnet.com/article/20409186/">グーグルが絵文字を世界標準に提案した理由&ndash;国際化エンジニアに聞くプロジェクトの舞台裏（前編） - CNET Japan</a></li>
<li><a href="https://japan.cnet.com/article/20409186/">グーグルが絵文字を世界標準に提案した理由&ndash;国際化エンジニアに聞くプロジェクトの舞台裏（前編） - CNET Japan</a></li>
<li><a href="https://internet.watch.impress.co.jp/docs/special/670150.html">「絵文字に平等をサポートしてください」人種差別の指摘にゆれるUnicode - INTERNET Watch Watch</a></li>
<li><a href="https://internet.watch.impress.co.jp/docs/special/678029.html">どんな人々がUnicodeの絵文字に「民族の多様性」を求めているのか？ - INTERNET Watch Watch</a></li>
<li><a href="https://internet.watch.impress.co.jp/docs/special/379269.html">絵文字を「符号」として処理する難しさ～日本のモバイルウェブのカオスぶり - INTERNET Watch Watch</a></li>
<li><a href="https://internet.watch.impress.co.jp/docs/special/380149.html">絵文字を「語」として処理する難しさ～定義通りとは限らない、絵文字の意味 - INTERNET Watch Watch</a></li>
<li><a href="https://internet.watch.impress.co.jp/docs/special/380180.html">絵文字を「語」として処理する難しさ～「ビール」と「飲み会」見分ける技術 - INTERNET Watch Watch</a></li>
</ul>
<p>その他のブックマーク：</p>
<ul>
<li><a href="https://lets-emoji.com/">Let&rsquo;s EMOJI｜絵文字一覧と絵文字検索🎉</a></li>
<li><a href="https://text.baldanders.info/remark/2020/10/emoji-variation-and-markdown/">絵文字と異体字と Markdown</a></li>
<li><a href="https://text.baldanders.info/golang/unicode-rangetables/">Unicode 文字種の判別</a></li>
<li><a href="https://zenn.dev/spiegel/articles/20210118-characters">やっかいな日本語</a></li>
</ul>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p><a href="https://golang.org/pkg/regexp/" title="regexp - The Go Programming Language"><code>regexp</code></a> パッケージの設計については <q><a href="https://swtch.com/~rsc/regexp/regexp1.html">Regular Expression Matching Can Be Simple And Fast</a></q> を参照のこと。&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p><a href="https://github.com/nyaosorg/go-readline-ny" title="nyaosorg/go-readline-ny: Readline library for golang , used in nyagos">nyaosorg/go-readline-ny</a> は同じ作者による <a href="https://github.com/nyaosorg/nyagos" title="nyaosorg/nyagos: NYAGOS - The hybrid Commandline Shell betweeeeeeen UNIX &amp; DOS">NYAGOS</a> からのスピンオフで，ターミナル・エミュレータからの入力制御に特化している。Emacs 風のキー・バインドでヒストリ機能を付けることもできる。元々は Windows 用だと思うが Ubuntu のターミナル・エミュレータでも問題なく機能するので重宝している。&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3">
<p>処理系によっては任意のコードを組み合わせて勝手に絵文字を作れたりするのかもしれないが，互換性がなくなるので「情報交換用」としては使えない。ちなみに <abbr class="emoji-chars" title=":A_button_(blood_type):">🅰</abbr> という絵文字はあるが，これは血液型（A型）を表す絵文字らしい。&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>

</div></section>

</article>
</main>
<nav class="page-nav">
<div class="prev-page">&laquo; <a href="/remark/2021/03/google-vs-oracle-3/">Google vs Oracle の訴訟の行方 3</a></div>
<div class="next-page"><a href="/remark/2021/04/emoji-list/">「情報交換用に推奨される絵文字のリスト」を作ってみた</a> &raquo;</div>
</nav>

<aside class="feedback" id='feedback'>
<h1>Feedback</h1>
<p>GitHub に<a href="https://github.com/spiegel-im-spiegel/github-pages-env/discussions">フィードバック用のディスカッションページ</a>を用意しました。
書き込みには GitHub のアカウントが必要ですが，お気軽にご利用ください。</p>
<p>他のフィードバック手段として Mastodon などの SNS や電子メールも利用できます。電子メールを利用する際の公開鍵は<a href="https://baldanders.info/profile/">プロフィール</a>から取得できます。</p>
</aside>
<footer>


<div class="userinfo">
	<div class="userinfo-avater">
		<a href="https://baldanders.info/profile/"><img src="https://text.baldanders.info/images/avatar.jpg" width="48" height="48" alt="avatar" id="logo"></a>
	</div>
	<div class="userinfo-info" id="maker">
		Text by <a href="https://baldanders.info/profile/" rel="cc:attributionURL" property="cc:attributionName">Spiegel</a>
		in <time property='dc:dateCopyrighted'>2021-03-30</time> (revised in 2021-12-04)
		<a rel='cc:license' href="https://creativecommons.org/licenses/by-sa/4.0/"><i class="fab fa-creative-commons"></i>&nbsp;<i class="fab fa-creative-commons-by"></i>&nbsp;<i class="fab fa-creative-commons-sa"></i></a>
		<ul class="social"><li><a rel="me" href="https://github.com/spiegel-im-spiegel"><span class="github-color"><abbr title="GitHub"><i class="fab fa-github"></i></abbr></span></a></li><li><a rel="me" href="https://www.flickr.com/photos/spiegel/"><span class="flickr-color"><abbr title="Flickr"><i class="fab fa-flickr"></i></abbr></span></a></li><li><a rel="me" href="https://goark.fedicity.net/@spiegel"><span class="mastodon-color"><abbr title="Mastodon"><i class="fa-brands fa-mastodon"></i></abbr></span></a></li><li><a rel="me" href="https://bsky.app/profile/baldanders.info"><span class="bluesky-color"><abbr title="Bluesky"><i class="fa-brands fa-bluesky"></i></abbr></span></a></li><li><a rel="me" href="https://www.strava.com/athletes/122077389"><span class="strava-color"><abbr title="Strava"><i class="fa-brands fa-strava"></i></abbr></span></a></li><li><a rel="me" href="https://x.com/spiegel_2007"><span class="x-twitter-color"><abbr title="X (Twitter)"><i class="fab fa-x-twitter"></i></abbr></span></a></li></ul>
	</div>
</div>

<nav>
<ul class='cloud center'>
<li><a href='/about-feeds/'>Feeds</a></li>
<li><a href='/reviews/'>Reviews</a></li>
<li><a href='/site-policy/'>Policy</a></li>
<li><a href='https://github.com/spiegel-im-spiegel/spiegel-im-spiegel.github.io'>Repository</a></li>
<li><a href='https://validator.w3.org/nu/?doc=https%3a%2f%2ftext.baldanders.info%2fremark%2f2021%2f03%2fterrible-emoji%2f&amp;showoutline=yes'>Debug</a></li>
</ul>
<ul class='cloud center'>
<li><a href='https://baldanders.info/'>Home</a></li>
<li><a href='https://photo.baldanders.info/'>Photos</a></li>
<li><a href='https://slide.baldanders.info/'>Slide</a></li>
<li><a href='https://zenn.dev/spiegel'>Zenn</a></li>
</ul>
<ul class='cloud center'>
<li>Powered by <a href='https://gohugo.io/'>Hugo 0.156.0</a> and <a href="https://github.com/spiegel-im-spiegel/hugo-theme-baldanders-info
">Theme of Baldanders.info</a>.</li>
</ul>
</nav>
</footer>
</div>

</body>
</html>
