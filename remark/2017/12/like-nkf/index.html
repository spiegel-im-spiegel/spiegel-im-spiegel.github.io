<!DOCTYPE html>
<html lang="ja">
<head prefix="og: http://ogp.me/ns#">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="generator" content="Hugo 0.37.1" />
<link rel="icon" type="image/x-icon" href="/favicon.ico">
<link rel="stylesheet" href="/css/local-font.css" type='text/css'>
<link rel='stylesheet' href='//fonts.googleapis.com/css?family=Noto+Serif%7cNoto+Sans%3a400,700%7cInconsolata%3a400,700' type='text/css'>
<link rel='stylesheet' href='//fonts.googleapis.com/earlyaccess/notosansjp.css' type='text/css'>
<link rel='stylesheet' href='http://www.baldanders.info/fonts/NotoSerifJP/NotoSerifJP.css' type='text/css'>
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/cc-icons/1.2.1/css/cc-icons.min.css">
<link rel="stylesheet" href="/css/main.css" type='text/css'>
<link rel="stylesheet" href="/css/text-baldanders.css" type='text/css'>
<script defer src="https://use.fontawesome.com/releases/v5.0.9/js/all.js"></script>
<link rel="alternate" href="http://text.baldanders.info/index.xml" type="application/rss+xml" title="text.Baldanders.info">
<meta name="google-site-verification" content="jTjBCslPtf8gwVatiY-GDgGv7pV5csa8aUOw1MRPUD4">
<link rel="stylesheet" href="/css/addon.css">
<link rel="stylesheet" href="/css/chroma-styles.css">

<link rel="canonical" href="http://text.baldanders.info/remark/2017/12/like-nkf/">
<title>「nkf っぽいなにか」を作った — しっぽのさきっちょ | text.Baldanders.info</title>
<meta property="og:title" content="「nkf っぽいなにか」を作った — しっぽのさきっちょ | text.Baldanders.info">
<meta name="description" content="思いつきで文字エンコーディングを変換するロジックを考えていたのだが，その副産物で「nkf っぽいなにか」を作ったので，併せてリリースする。">
<meta property="og:description" content="思いつきで文字エンコーディングを変換するロジックを考えていたのだが，その副産物で「nkf っぽいなにか」を作ったので，併せてリリースする。">
<meta property="og:image" content="http://text.baldanders.info/images/attention/remark.jpg">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@spiegel_2007">
<meta name="twitter:creator" content="@spiegel_2007">
<meta name="author" content="Spiegel">
<meta name="keywords" content="tools, golang, character, encoding, transform">
<link rel='prev' href='http://text.baldanders.info/remark/2017/12/openpgp-section/' title='「OpenPGP の実装」セクションを開設した' />
<link rel='next' href='http://text.baldanders.info/remark/2017/12/character-of-the--new-era-name/' title='新元号「文字」という技術的負債' />

<script type="application/ld+json">
{
	"@context": "http://schema.org",
	"@type": "WebSite",
	"@id": "http://text.baldanders.info/",
	"inLanguage": "ja",
	"name": "text.Baldanders.info",
    "url": "http://text.baldanders.info/",
	"publisher": {
		"@id": "http://text.baldanders.info/#org"
	},
	"author": {
		"@id": "http://text.baldanders.info/#maker"
	},
	"image": "http://text.baldanders.info/images/avatar.jpg",
	"description": "帰ってきた「しっぽのさきっちょ」"
}
</script>
<script type="application/ld+json">
{
	"@context": "http://schema.org",
	"@type": "Organization",
	"@id": "http://text.baldanders.info/#org",
	"name": "text.Baldanders.info",
	"logo": {
		"@type": "ImageObject",
		"@id": "http://text.baldanders.info/#logo",
		"url": "http://text.baldanders.info/images/avatar.jpg"
	}
}
</script>
<script type="application/ld+json">
{
	"@context": "http://schema.org",
	"@type": "Person",
	"@id": "http://text.baldanders.info/#maker",
	"name": "Spiegel",
	"url": "http://www.baldanders.info/spiegel/profile/",
	"image": "http://text.baldanders.info/images/avatar.jpg"
}
</script>
<script type="application/ld+json">
{
	"@context": "http://schema.org",
	"@type": "Blog",
	"@id": "http://text.baldanders.info/remark/",
	"url": "http://text.baldanders.info/remark/",
	"inLanguage": "ja",
	"name": "しっぽのさきっちょ",
	"description": "とりとめのない四方山話。",
	"image": "http://text.baldanders.info/images/attention/remark.jpg",
	"publisher": {
		"@id": "http://text.baldanders.info/#org"
	},
	"author": {
		"@id": "http://text.baldanders.info/#maker"
	}
}
</script>
<script type="application/ld+json">
{
	"@context": "http://schema.org",
	"@type": "BreadcrumbList",
	"@id": "http://text.baldanders.info/remark/2017/12/like-nkf/#breadcrumb-list",
	"itemListElement": [
		{
			"@type": "ListItem",
			"position": 1,
			"item": {
				"@id": "http://text.baldanders.info/"
			}
		},
		{
			"@type": "ListItem",
			"position": 2,
			"item": {
				"@id": "http://text.baldanders.info/remark/"
			}
		}
	]
}
</script>
<script type="application/ld+json">
{
	"@context": "http://schema.org",
	"@type": "BlogPosting",
	"@id": "http://text.baldanders.info/remark/2017/12/like-nkf/",
	"url": "http://text.baldanders.info/remark/2017/12/like-nkf/",
	"mainEntityOfPage": "http://text.baldanders.info/remark/2017/12/like-nkf/",
	"inLanguage": "ja",
	"name": "「nkf っぽいなにか」を作った",
	"description": "思いつきで文字エンコーディングを変換するロジックを考えていたのだが，その副産物で「nkf っぽいなにか」を作ったので，併せてリリースする。",
	"headline": "思いつきで文字エンコーディングを変換するロジックを考えていたのだが，その副産物で「nkf っぽいなにか」を作ったので，併せてリリースする。",
	"keywords": "tools, golang, character, encoding, transform",
	"image": "http://text.baldanders.info/images/attention/remark.jpg",
	"datePublished": "2017-12-06T01:20:36+09:00",
	"dateModified": "2018-02-15T07:19:42+09:00",
	"publisher": {
		"@id": "http://text.baldanders.info/#org"
	},
	"author": {
		"@type": "Person",
		"@id": "http://text.baldanders.info/remark/2017/12/like-nkf/#maker",
		"name": "Spiegel",
		"url": "http://www.baldanders.info/spiegel/profile/",
		"image": "http://text.baldanders.info/images/avatar.jpg"
	},
	"license": "http://creativecommons.org/licenses/by-sa/4.0/"
}
</script>
</head>
<body>

<div id='container'>

<main>
<nav class="breadcrumb">
<a href="http://text.baldanders.info/">text.Baldanders.info</a> &raquo; <a href="http://text.baldanders.info/remark/">しっぽのさきっちょ</a>
</nav>
<article>
<h1>「nkf っぽいなにか」を作った</h1>
<nav class="tags">
<div><a href="/tags">Tags</a>: #<a href="/tags/character">character</a> #<a href="/tags/encoding">encoding</a> #<a href="/tags/golang">golang</a> #<a href="/tags/tools">tools</a> #<a href="/tags/transform">transform</a></div>
<div><a href="https://github.com/spiegel-im-spiegel/spiegel-im-spiegel.github.io/commits/master/remark/2017/12/like-nkf/index.html">History</a></div>
</nav>

<section><div>
<div style="float:right;margin-left:0.5rem;margin-bottom:0.5rem;padding-left:0.5rem;padding-bottom:0.5rem;">
<a href="http://www.baldanders.info/spiegel/log2/000820.shtml" title="Stop Fast Track TPP — Baldanders.info"><img src="http://www.baldanders.info/images/noextension.png" alt="no extension" width="165" height="50" /></a>
</div>


<p>思いつきで<a href="/golang/detecting-character-encoding/">文字エンコーディングを変換するロジックを考えていた</a>のだが，その副産物で「nkf っぽいなにか」を作ったので，併せてリリースする。</p>

<ul>
<li><a href="https://github.com/spiegel-im-spiegel/text/releases/tag/v0.3.0">Release v0.3.0 · spiegel-im-spiegel/text · GitHub</a></li>
</ul>

<p>リリースパッケージに含まれる gonkf がそれ。
nkf のように文字エンコーディングを指定して変換を行う。
使い方はこんな感じ。</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">$ gonkf -h
Network Kanji Filter by Golang

Usage:
  gonkf [flags]
  gonkf [command]

Available Commands:
  conv        Convert character encoding of text
  guess       Guess character encoding of text
  help        Help about any command
  norm        Unicode normalization
  nwline      Convert newline of text
  version     Print the version number of gonkf
  width       Convert character width of text

Flags:
  -h, --help   help for gonkf

Use &#34;gonkf [command] --help&#34; for more information about a command.</code></pre></div>
<p>nkf と異なり，サブコマンド方式にした。
文字エンコーディング変換なら <code>conv</code> サブコマンドを使う。</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">$ gonkf conv -h
Convert character encoding of text

Usage:
  gonkf conv [flags] [text file]

Flags:
  -d, --dst-encoding string   character encoding of destination text
  -h, --help                  help for conv
  -n, --newline string        type of newline
  -o, --output string         output file path
  -s, --src-encoding string   character encoding of source text</code></pre></div>
<p>たとえば Shift-JIS のテキストを UTF-8 に変換したい場合は以下のようにする。</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">$ gonkf conv -s sjis -d utf8 SHIFT_JIS.txt
こんにちは。世界の国から。</code></pre></div>
<p>元テキストの文字エンコーディング指定を省略すると，元テキストの文字エンコーディングを推測して変換する。</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">$ gonkf conv -d utf8 SHIFT_JIS.txt
こんにちは。世界の国から。</code></pre></div>
<p>文字エンコーディングの推測のみ実行したい場合は <code>guess</code> サブコマンドを使う。</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">$ gonkf guess SHIFT_JIS.txt
Shift_JIS</code></pre></div>
<p>nkf にない機能（多分）としては Unicode 正規化ができる。
たとえば半角カナの「ﾍﾟﾝｷﾞﾝ」を事前合成形に正規化すると</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">$ echo ﾍﾟﾝｷﾞﾝ | gonkf norm -f NFKC
ペンギン</code></pre></div>
<p>となる。
Unicode 正規化については以下の記事を参照のこと。</p>

<ul>
<li><a href="/golang/unicode-normalization/">Go 言語と Unicode 正規化</a></li>
</ul>

<p>文字エンコーディング変換で元テキストの文字エンコーディングを推測する場合，文字列が短いと誤判定する確率が跳ね上がるので注意（特に Shift-JIS と EUC）。
また ISO-2022-JP (<code>jis</code>) に変換する際，変換ロジックにバグがあるようで，文字列の末尾が改行で終わらない場合に文字セットを US-ASCII に戻す指示シーケンス（1BH 28H 42H）が出力されない<sup class="footnote-ref" id="fnref:jis1"><a href="#fn:jis1">1</a></sup>。
末尾が改行で終わる場合は大丈夫。</p>

<p>nkf みたいなツールは15年以上前なら割と重宝してたけど，今はテキスト・エディタの機能でちょいちょいと変換できるので，あんまり使わなくなったよなぁ。
まぁ，今回は自作のパッケージの使い勝手を確認するための習作なので，こんなもんだろう。</p>

<h2 id="追記-半角-全角変換機能を追加した">【追記】 半角/全角変換機能を追加した</h2>

<ul>
<li><a href="/golang/character-width-for-unicode/">Go 言語による Unicode 半角/全角変換</a></li>
</ul>

<p>というわけで，半角/全角変換機能の追加と諸々修正・変更した v0.5.0 をリリースした。</p>

<ul>
<li><a href="https://github.com/spiegel-im-spiegel/text/releases/tag/v0.5.0">Release v0.5.0 · spiegel-im-spiegel/text</a></li>
</ul>

<p>多分もう機能追加はしないはず。</p>
<div class="footnotes">

<hr />

<ol>
<li id="fn:jis1">おそらく「行末に指示シーケンスを出力」するのではなく「改行コードの手前で指示シーケンスを出力」しているのだろう。昔はこの手の安直な実装が結構あって，電子署名の検証が valid にならなかったりと苦労した記憶があるが，今だに残ってるものなんだねぇ。まぁ ISO-2022-JP ってだいぶ廃れてきてると思うので，放置しても実害はないだろう。
 <a class="footnote-return" href="#fnref:jis1"><sup>[return]</sup></a></li>
</ol>
</div>

</div></section>

</article>
</main>
<nav class="page-nav">
<div class="prev-page">&laquo; <a href="/remark/2017/12/openpgp-section/">「OpenPGP の実装」セクションを開設した</a></div>
<div class="next-page"><a href="/remark/2017/12/character-of-the--new-era-name/">新元号「文字」という技術的負債</a> &raquo;</div>
</nav>

<aside id='tech-terms'>
<style>
#tech-terms h1 {
  border: solid thin gray;
  margin: 0 0 1rem 0;
  padding: 0 0.5rem 2px 2px;
}
</style>
<h1>Technical Terms</h1>
<div class="cloud" style="font-size:smaller;">
<script src="http://e-words.jp/embed.x?e=utf8"></script>
<p class="right">Powered by <a href="http://e-words.jp/p/s-embed.html">e-Words</a></p>
</div>
</aside>
<aside id='feedback'>
<style>
#feedback h1 {
  border: solid thin gray;
  margin: 0 0 1rem 0;
  padding: 0 0.5rem 2px 2px;
}
</style>
<h1>Feedback</h1>
<div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "textbaldandersinfo" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</aside>
<footer>

	<div class="userinfo">
		<div class="userinfo-avater">
			
				<a href="http://www.baldanders.info/spiegel/profile/"><img src="/images/avatar.jpg" width="48" height="48" alt="avatar"></a>
			
		</div>
		<div class="userinfo-info" id="maker">
			
				Written by <a href="http://www.baldanders.info/spiegel/profile/" rel="cc:attributionURL" property="cc:attributionName">Spiegel</a> in <time property='dc:dateCopyrighted'>2017-12-06</time> (revised in <time property='dc:modified'>2018-02-15</time>).
				
	<a rel='cc:license' href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank"><i class="cc cc-cc"></i>&nbsp;<i class="cc cc-by"></i>&nbsp;<i class="cc cc-sa"></i></a>

			
			
	<ul class="social">
		<li><a href="https://github.com/spiegel-im-spiegel" target="_blank"><i class="fab fa-github"></i></a></li>
		<li><a href="https://twitter.com/spiegel_2007" target="_blank"><i class="fab fa-twitter"></i></a></li>
		
		<li><a href="http://spiegel-im-spiegel.tumblr.com/" target="_blank"><i class="fab fa-tumblr"></i></a></li>
		<li><a href="http://instagram.com/spiegel_2007" target="_blank"><i class="fab fa-instagram"></i></a></li>
		<li><a href="https://www.flickr.com/photos/spiegel/" target="_blank"><i class="fab fa-flickr"></i></a></li>
		<li><a href="https://www.facebook.com/spiegel.im.spiegel" target="_blank"><i class="fab fa-facebook-f"></i></a></li>
		<li><a href="https://jp.linkedin.com/in/spiegelimspiegel" target="_blank"><i class="fab fa-linkedin-in"></i></a></li>
		
	</ul>
	<ul class="social">
		<li><a href="http://www.facebook.com/share.php?u=http%3a%2f%2ftext.baldanders.info%2fremark%2f2017%2f12%2flike-nkf%2f" target="_blank"><i class="fab fa-facebook-square fa-2x" aria-hidden="true"></i></a></li>
		<li><a href="http://twitter.com/share?text=%e3%80%8cnkf%20%e3%81%a3%e3%81%bd%e3%81%84%e3%81%aa%e3%81%ab%e3%81%8b%e3%80%8d%e3%82%92%e4%bd%9c%e3%81%a3%e3%81%9f+from+@spiegel_2007&amp;url=http%3a%2f%2ftext.baldanders.info%2fremark%2f2017%2f12%2flike-nkf%2f" target="_blank"><i class="fab fa-twitter-square fa-2x" aria-hidden="true"></i></a></li>
		<li><a href="https://flattr.com/submit/auto?user_id=spiegel&amp;url=http%3a%2f%2ftext.baldanders.info%2fremark%2f2017%2f12%2flike-nkf%2f&amp;title=%e3%80%8cnkf%20%e3%81%a3%e3%81%bd%e3%81%84%e3%81%aa%e3%81%ab%e3%81%8b%e3%80%8d%e3%82%92%e4%bd%9c%e3%81%a3%e3%81%9f" target="_blank"><img src="//button.flattr.com/flattr-badge-large.png" alt="Flattr this" title="Flattr this"></a></li>
	</ul>

		</div>
	</div>

<nav>
<ul class='cloud center'>
<li><a href='https://github.com/spiegel-im-spiegel/spiegel-im-spiegel.github.io'>Repository</a></li>
<li><a href='/reviews/'>Reviews</a></li>
<li><a href='/about-feeds/'>Feeds</a></li>
<li><a href='/site-policy/'>Site Policy</a></li>
<li><a href='https://validator.w3.org/nu/?doc=http%3a%2f%2ftext.baldanders.info%2fremark%2f2017%2f12%2flike-nkf%2f&amp;showoutline=yes'>Debug</a></li>
</ul>
<ul class='cloud center'>
<li><a href='http://www.baldanders.info/'>Baldanders.info</a></li>
<li><a href='https://scrapbox.io/spiegel-branch/'>Scrapbox</a></li>
<li><a href='http://qiita.com/spiegel-im-spiegel'>Qiita</a></li>
</ul>
<ul class='cloud center'>
<li>Powered by <a href='https://gohugo.io/'>Hugo 0.37.1</a> and <a href="https://github.com/spiegel-im-spiegel/hugo-theme-text">Text</a>.</li>
</ul>
</nav>
</footer>
</div>


</body>
</html>
