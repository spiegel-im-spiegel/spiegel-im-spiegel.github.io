<!DOCTYPE html>
<html lang="ja">
<head prefix="og: http://ogp.me/ns#">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="generator" content="Hugo 0.146.7">
<link rel="icon" type="image/x-icon" href="/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
<link rel="apple-touch-icon" type="image/png" sizes="144x144" href="/apple-icon-144x144.png">
<link rel="icon" type="image/png" sizes="192x192"  href="/android-icon-192x192.png">
<link rel="manifest" href="/manifest.json">
<link rel="canonical" href="https://text.baldanders.info/golang/webassembly-with-tinygo/">
<script defer src="/fa/js/all.min.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=BIZ+UDGothic:wght@400;700&family=BIZ+UDMincho&family=Inconsolata:wght@400;700&family=Noto+Color+Emoji&family=Noto+Sans:wght@400;700&family=Noto+Serif&display=swap" rel="stylesheet">
<link rel="stylesheet" href="/css/local-font.css" type='text/css'>
<link rel="stylesheet" href="/css/baldanders-info-dark.css" type='text/css'>

<link rel="alternate" href="https://text.baldanders.info/index.xml" type="application/rss+xml" title="text.Baldanders.info">
<link rel="alternate" href="https://text.baldanders.info/index.json" type="application/json" title="text.Baldanders.info">
<meta name="google-site-verification" content="jTjBCslPtf8gwVatiY-GDgGv7pV5csa8aUOw1MRPUD4">
<link rel="me" href="https://fedibird.com/@spiegel">
<title>TinyGo で WebAssembly | text.Baldanders.info</title>
<meta property="og:title" content="TinyGo で WebAssembly">
<meta name="description" content="Go および TinyGo を使って WebAssembly へのコンパイルを行い Web ブラウザ上で動作させるところまでやってみる">
<meta property="og:description" content="Go および TinyGo を使って WebAssembly へのコンパイルを行い Web ブラウザ上で動作させるところまでやってみる">
<meta property="og:image" content="https://text.baldanders.info/images/attention/go-logo_blue.png">
<meta name="author" content="Spiegel">


<meta name="twitter:card" content="summary">
<link rel="me" href="https://goark.fedicity.net/@spiegel">
<meta name="keywords" content="programming, golang, tinygo, webassembly">
<link rel='prev' href='https://text.baldanders.info/golang/special-forms/' title='特殊形式による式評価について'>
<link rel='next' href='https://text.baldanders.info/golang/wasi-with-tinygo/' title='TinyGo で WASI 【失敗編】'>

<script type="application/ld+json">
{
	"@context": "http://schema.org",
	"@type": "WebSite",
	"@id": "https://text.baldanders.info/",
	"inLanguage": "ja",
	"name": "text.Baldanders.info",
    "url": "https://text.baldanders.info/",
	"publisher": {
		"@id": "https://text.baldanders.info/#org"
	},
	"author": {
		"@id": "https://text.baldanders.info/#maker"
	},
	"image": "https://text.baldanders.info/images/attention/site.jpg",
	"description": "帰ってきた「しっぽのさきっちょ」"
}
</script>
<script type="application/ld+json">
{
	"@context": "http://schema.org",
	"@type": "Organization",
	"@id": "https://text.baldanders.info/#org",
	"name": "Spiegel",
	"logo": {
		"@type": "ImageObject",
		"@id": "https://text.baldanders.info/#logo",
		"url": "https://text.baldanders.info/images/avatar.jpg"
	}
}
</script>
<script type="application/ld+json">
{
	"@context": "http://schema.org",
	"@type": "Person",
	"@id": "https://text.baldanders.info/#maker",
	"name": "Spiegel",
	"url": "https://baldanders.info/profile/",
	"image": "https://text.baldanders.info/images/avatar.jpg"
}
</script>
<script type="application/ld+json">
{
	"@context": "http://schema.org",
	"@type": "Blog",
	"@id": "https://text.baldanders.info/golang/",
	"url": "https://text.baldanders.info/golang/",
	"inLanguage": "ja",
	"name": "プログラミング言語 Go",
	"description": "Go 言語プログラミングに関する話題。",
	"image": "https://text.baldanders.info/images/attention/go-logo_blue.png",
	"publisher": {
		"@id": "https://text.baldanders.info/#org"
	},
	"author": {
		"@id": "https://text.baldanders.info/#maker"
	}
}
</script>
<script type="application/ld+json">
{
	"@context": "http://schema.org",
	"@type": "BreadcrumbList",
	"@id": "https://text.baldanders.info/golang/webassembly-with-tinygo/#breadcrumb-list",
	"itemListElement": [
		{
			"@type": "ListItem",
			"position": 1,
			"item": {
				"@id": "https://text.baldanders.info/"
			}
		},
		{
			"@type": "ListItem",
			"position": 2,
			"item": {
				"@id": "https://text.baldanders.info/golang/"
			}
		}
	]
}
</script>
<script type="application/ld+json">
{
	"@context": "http://schema.org",
	"@type": "BlogPosting",
	"@id": "https://text.baldanders.info/golang/webassembly-with-tinygo/",
	"url": "https://text.baldanders.info/golang/webassembly-with-tinygo/",
	"mainEntityOfPage": "https://text.baldanders.info/golang/webassembly-with-tinygo/",
	"inLanguage": "ja",
	"name": "TinyGo で WebAssembly",
	"description": "Go および TinyGo を使って WebAssembly へのコンパイルを行い Web ブラウザ上で動作させるところまでやってみる",
	"headline": "Go および TinyGo を使って WebAssembly へのコンパイルを行い Web ブラウザ上で動作させるところまでやってみる",
	"keywords": "programming, golang, tinygo, webassembly",
	"image": "https://text.baldanders.info/images/attention/go-logo_blue.png",
	"datePublished": "2021-03-11T12:01:29+00:00",
	"dateModified": "2024-05-10T22:02:32+00:00",
	"publisher": {
		"@id": "https://text.baldanders.info/#org"
	},
	"author": {
		"@id": "https://text.baldanders.info/#maker"
	},
	"license": "https://creativecommons.org/licenses/by-sa/4.0/"
}
</script>
</head>
<body>

<div id='container'>

<main>
<nav class="breadcrumb">
<a href="https://text.baldanders.info/">text.Baldanders.info</a> &raquo; <a href="/golang/">プログラミング言語 Go</a>
</nav>
<article>
<h1>TinyGo で WebAssembly</h1>
<nav class="tags">
	<div><a href='/tags/'>Tags</a>: #<a href="/tags/golang/">golang</a> #<a href="/tags/programming/">programming</a> #<a href="/tags/tinygo/">tinygo</a> #<a href="/tags/webassembly/">webassembly</a></div>
	<div class="cloud">
		<span class="share-color" title="Share this entry"><i class="fas fa-share-square"></i></span>&nbsp;:
		&nbsp;<a href="https://getpocket.com/edit?url=https%3a%2f%2ftext.baldanders.info%2fgolang%2fwebassembly-with-tinygo%2f&amp;title=TinyGo%20%e3%81%a7%20WebAssembly" target="_blank"><span class="pocket-color"><abbr title="Share Pocket"><i class="fab fa-get-pocket" aria-hidden="true"></i></abbr></span></a>
		&nbsp;<a href="http://www.facebook.com/share.php?u=https%3a%2f%2ftext.baldanders.info%2fgolang%2fwebassembly-with-tinygo%2f" target="_blank"><span class="facebook-color"><abbr title="Share facebook"><i class="fab fa-facebook-square" aria-hidden="true"></i></abbr></span></a>
		&nbsp;<a href="http://twitter.com/share?text=TinyGo%20%e3%81%a7%20WebAssembly&amp;url=https%3a%2f%2ftext.baldanders.info%2fgolang%2fwebassembly-with-tinygo%2f" target="_blank"><span class="twitter-color"><abbr title="Share Twitter"><i class="fab fa-twitter-square" aria-hidden="true"></i></abbr></span></a>
		&nbsp;<a href="https://donshare.net/share.html?text=TinyGo%20%e3%81%a7%20WebAssembly+by+@spiegel%40goark.fedicity.net%20+https%3a%2f%2ftext.baldanders.info%2fgolang%2fwebassembly-with-tinygo%2f" target="_blank"><span class="mastodon-color"><abbr title="Share Mastodon"><i class="fa-brands fa-mastodon"></i></abbr></span></a>
	</div>
</nav>
<nav class="history">History in
  <a href="https://github.com/spiegel-im-spiegel/spiegel-im-spiegel.github.io/commits/master/golang/webassembly-with-tinygo/index.html">GitHub Page</a>
</nav>

<section>
<p><a href="https://tinygo.org/" title="TinyGo - Go on Microcontrollers and WASM">TinyGo</a> は本家 <a href="https://go.dev/">Go</a> のサブセットと言えるもので <a href="https://llvm.org/" title="The LLVM Compiler Infrastructure Project">LLVM</a> を使った組み込み用途特化のコンパイラである。
しかも <a href="https://llvm.org/" title="The LLVM Compiler Infrastructure Project">LLVM</a> が <a href="https://webassembly.org/" title="WebAssembly">WebAssembly</a> バイナリを直接出力できるということもあって <a href="https://tinygo.org/" title="TinyGo - Go on Microcontrollers and WASM">TinyGo</a> と <a href="https://webassembly.org/" title="WebAssembly">WebAssembly</a> の相性は本家 <a href="https://go.dev/">Go</a> 以上と言える。</p>
<p>というわけで今回は， <a href="https://go.dev/">Go</a> および <a href="https://tinygo.org/" title="TinyGo - Go on Microcontrollers and WASM">TinyGo</a> を使って <a href="https://webassembly.org/" title="WebAssembly">WebAssembly</a> へのコンパイルを行い， Web ブラウザ上で動作させるところまでやってみることにする。</p>
<h2><a href="https://tinygo.org/" title="TinyGo - Go on Microcontrollers and WASM">TinyGo</a> のインストール</h2>
<p><a href="https://tinygo.org/" title="TinyGo - Go on Microcontrollers and WASM">TinyGo</a> が動作するためには，あらかじめ本家 <a href="https://go.dev/">Go</a> のツールチェーンが導入済みであることが前提となる。
この記事では <a href="https://go.dev/">Go</a> は導入済みであるとして話を進める。</p>
<p><a href="https://tinygo.org/" title="TinyGo - Go on Microcontrollers and WASM">TinyGo</a> は以下のリポジトリから最新版をダウンロード&amp;インストールする。</p>
<ul>
<li><a href="https://github.com/tinygo-org/tinygo">tinygo-org/tinygo: Go compiler for small places. Microcontrollers, WebAssembly, and command-line tools. Based on LLVM.</a></li>
</ul>
<p>2021-03-11 時点での最新版は 0.17.0 である。
<a href="https://go.dev/">Go</a> 1.16 以降が推奨らしい。</p>
<h3>Ubuntu の場合</h3>
<p>Ubuntu の APT や Snap の公式リポジトリにはないので， deb ファイルをダウンロードし，手動でインストールする。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">$ curl -L https://github.com/tinygo-org/tinygo/releases/download/v0.17.0/tinygo_0.17.0_amd64.deb -O
</span></span><span class="line"><span class="cl">$ sudo dpkg -i tinygo_0.17.0_amd64.deb
</span></span><span class="line"><span class="cl">$ tinygo version
</span></span><span class="line"><span class="cl">tinygo version 0.17.0 linux/amd64 (using go version go1.16.1 and LLVM version 11.0.0)
</span></span></code></pre></div><p>ちなみに WSL/WSL2 上の Ubuntu にもインストール可能だそうだ。</p>
<h3>Windows の場合</h3>
<p>Windows なら <a href="https://scoop.sh/" title="Scoop">Scoop</a> を使うのが最も簡単である。
<a href="https://scoop.sh/" title="Scoop">Scoop</a> なら本家 <a href="https://go.dev/">Go</a> も簡単にインストールできるし <a href="https://tinygo.org/" title="TinyGo - Go on Microcontrollers and WASM">TinyGo</a> 用の周辺ツールも <a href="https://scoop.sh/" title="Scoop">Scoop</a> で簡単に導入できる。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">$ scoop install tinygo
</span></span><span class="line"><span class="cl">$ tinygo version
</span></span><span class="line"><span class="cl">tinygo version 0.17.0 windows/amd64 (using go version go1.16.1 and LLVM version 11.0.0)
</span></span></code></pre></div><h3>Docker の場合</h3>
<p>Docker 環境も用意されているそうだ。
詳しくはこちら。</p>
<ul>
<li><a href="https://tinygo.org/getting-started/using-docker/">Docker :: TinyGo - Go on Microcontrollers and WASM</a></li>
</ul>
<h2>ファイル構成</h2>
<p>今回のファイル構成はこんな感じ。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">$ tree .
</span></span><span class="line"><span class="cl">.
</span></span><span class="line"><span class="cl">├── hello
</span></span><span class="line"><span class="cl">│   ├── hello.go
</span></span><span class="line"><span class="cl">│   ├── index.html
</span></span><span class="line"><span class="cl">│   ├── wasm.js
</span></span><span class="line"><span class="cl">│   └── wasm_exec.js
</span></span><span class="line"><span class="cl">└── main.go
</span></span></code></pre></div><p><code>main.go</code> は簡易サーバのコードで，こんな感じになっている。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;embed&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;fmt&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;io/fs&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;net/http&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;os&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;strings&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//go:embed hello</span>
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">assets</span> <span class="nx">embed</span><span class="p">.</span><span class="nx">FS</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">addr</span> <span class="o">:=</span> <span class="s">&#34;localhost:3000&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;Open http://%s/\n&#34;</span><span class="p">,</span> <span class="nx">addr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Press ctrl+c to stop&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">root</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">fs</span><span class="p">.</span><span class="nf">Sub</span><span class="p">(</span><span class="nx">assets</span><span class="p">,</span> <span class="s">&#34;hello&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fs</span> <span class="o">:=</span> <span class="nx">http</span><span class="p">.</span><span class="nf">FileServer</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nf">FS</span><span class="p">(</span><span class="nx">root</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="nx">http</span><span class="p">.</span><span class="nf">Handle</span><span class="p">(</span><span class="s">&#34;/&#34;</span><span class="p">,</span> <span class="nx">http</span><span class="p">.</span><span class="nf">FileServer</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nf">FS</span><span class="p">(</span><span class="nx">root</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">http</span><span class="p">.</span><span class="nf">ListenAndServe</span><span class="p">(</span><span class="nx">addr</span><span class="p">,</span> <span class="nx">http</span><span class="p">.</span><span class="nf">HandlerFunc</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">resp</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span> <span class="nx">req</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">resp</span><span class="p">.</span><span class="nf">Header</span><span class="p">().</span><span class="nf">Add</span><span class="p">(</span><span class="s">&#34;Cache-Control&#34;</span><span class="p">,</span> <span class="s">&#34;no-cache&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">HasSuffix</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nx">Path</span><span class="p">,</span> <span class="s">&#34;.wasm&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">resp</span><span class="p">.</span><span class="nf">Header</span><span class="p">().</span><span class="nf">Set</span><span class="p">(</span><span class="s">&#34;content-type&#34;</span><span class="p">,</span> <span class="s">&#34;application/wasm&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nx">fs</span><span class="p">.</span><span class="nf">ServeHTTP</span><span class="p">(</span><span class="nx">resp</span><span class="p">,</span> <span class="nx">req</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}));</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">fmt</span><span class="p">.</span><span class="nf">Fprintln</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Stderr</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p><a href="https://golang.org/pkg/embed/" title="embed - The Go Programming Language"><code>embed</code></a> パッケージと <code>//go:embed</code> ディレクティブが便利！ 簡易サーバのコードについては拙文「<a href="/golang/embeded-filesystem/">紙芝居用の簡易サーバを書く【Go 1.16 版】</a> 」を参照のこと。
今回用の設定としては <code>*.wasm</code> ファイルの Content-Type を <code>application/wasm</code> にすることくらいかな。
あとは <code>no-cache</code> の設定ね。</p>
<p><code>wasm_exec.js</code> ファイルは <a href="https://go.dev/">Go</a> および <a href="https://tinygo.org/" title="TinyGo - Go on Microcontrollers and WASM">TinyGo</a> が用意しているファイルで，以下からコピってそのまま使えばよい。</p>
<table>
  <thead>
      <tr>
          <th>処理系</th>
          <th>パス</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><a href="https://go.dev/">Go</a></td>
          <td><code>$GOROOT/misc/wasm/wasm_exec.js</code></td>
      </tr>
      <tr>
          <td><a href="https://tinygo.org/" title="TinyGo - Go on Microcontrollers and WASM">TinyGo</a></td>
          <td><code>$TINYGOROOT/targets/wasm_exec.js</code></td>
      </tr>
  </tbody>
</table>
<p><code>$GOROOT</code> および <code>$TINYGOROOT</code> の値は，以下のコマンドで取得できる。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">$ tinygo env
</span></span><span class="line"><span class="cl">GOOS=&#34;linux&#34;
</span></span><span class="line"><span class="cl">GOARCH=&#34;amd64&#34;
</span></span><span class="line"><span class="cl">GOROOT=&#34;/usr/local/go1.16.1&#34;
</span></span><span class="line"><span class="cl">GOPATH=&#34;/home/username/go&#34;
</span></span><span class="line"><span class="cl">GOCACHE=&#34;/home/username/.cache/tinygo&#34;
</span></span><span class="line"><span class="cl">CGO_ENABLED=&#34;1&#34;
</span></span><span class="line"><span class="cl">TINYGOROOT=&#34;/usr/local/lib/tinygo&#34;
</span></span></code></pre></div><h2>みんな大好き Hello World</h2>
<p>さて <code>hello/hello.go</code> ファイルの中身だが，まずはこんな感じで。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// +build js,wasm</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="s">&#34;syscall/js&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">ch</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kd">struct</span><span class="p">{})</span>
</span></span><span class="line"><span class="cl">    <span class="nx">js</span><span class="p">.</span><span class="nf">Global</span><span class="p">().</span><span class="nf">Get</span><span class="p">(</span><span class="s">&#34;document&#34;</span><span class="p">).</span><span class="nf">Call</span><span class="p">(</span><span class="s">&#34;getElementById&#34;</span><span class="p">,</span> <span class="s">&#34;hello&#34;</span><span class="p">).</span><span class="nf">Set</span><span class="p">(</span><span class="s">&#34;innerHTML&#34;</span><span class="p">,</span> <span class="s">&#34;Hello, World!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;-</span><span class="nx">ch</span> <span class="c1">// Code must not finish</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>JavaScript の DOM 構造に慣れている人ならそんなに難しくないだろう。
ID 名 <code>hello</code> の要素に文字列 <code>Hello, World!</code> を突っ込むだけの簡単なお仕事（笑）</p>
<p>これを <a href="https://go.dev/">Go</a> および <a href="https://tinygo.org/" title="TinyGo - Go on Microcontrollers and WASM">TinyGo</a> の各コンパイラでコンパイルしてみる。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">$ GOOS=js GOARCH=wasm go build -o hello1.wasm -trimpath
</span></span><span class="line"><span class="cl">$ tinygo build -o hello2.wasm -target wasm ./hello.go
</span></span></code></pre></div><p>前者が本家 <a href="https://go.dev/">Go</a> によるコンパイルで，後者が <a href="https://tinygo.org/" title="TinyGo - Go on Microcontrollers and WASM">TinyGo</a> によるコンパイルだ。
コンパイル結果は以下の通り。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">$ ll *.wasm
</span></span><span class="line"><span class="cl">-rwxrwxr-x 1 username username 1364695  3月 10 23:59 hello1.wasm*
</span></span><span class="line"><span class="cl">-rwxrwxr-x 1 username username   67375  3月 10 23:59 hello2.wasm*
</span></span></code></pre></div><p>おうふ。
こんなに違うのか。</p>
<p>本家 <a href="https://go.dev/">Go</a> のコードが大きいのは，良くも悪くも POSIX 互換環境への依存度が高く組み込み用途に使うには余計なコードを抱え込んでしまうという事情がある。</p>
<p>一方 <a href="https://tinygo.org/" title="TinyGo - Go on Microcontrollers and WASM">TinyGo</a> は <a href="https://llvm.org/" title="The LLVM Compiler Infrastructure Project">LLVM</a> の制約を受けるため，ガベージコレクションや並行処理などで本家 <a href="https://go.dev/">Go</a> とは異なる挙動になる（他にもいくつかの標準パッケージが使えない場合があるらしい）。</p>
<p>たとえば先ほどの</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">ch</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kd">struct</span><span class="p">{})</span>
</span></span><span class="line"><span class="cl">    <span class="nx">js</span><span class="p">.</span><span class="nf">Global</span><span class="p">().</span><span class="nf">Get</span><span class="p">(</span><span class="s">&#34;document&#34;</span><span class="p">).</span><span class="nf">Call</span><span class="p">(</span><span class="s">&#34;getElementById&#34;</span><span class="p">,</span> <span class="s">&#34;hello&#34;</span><span class="p">).</span><span class="nf">Set</span><span class="p">(</span><span class="s">&#34;innerHTML&#34;</span><span class="p">,</span> <span class="s">&#34;Hello, World!&#34;</span><span class="p">)</span>
</span></span><span class="line hl"><span class="cl">    <span class="o">&lt;-</span><span class="nx">ch</span> <span class="c1">// Code must not finish</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>の最後を見ると，チャネル受信状態で処理が止まっているが（というか止めるためにわざわざこのように書いているのだが），これがないと <a href="https://tinygo.org/" title="TinyGo - Go on Microcontrollers and WASM">TinyGo</a> コンパイラがエラーを吐く場合があるようだ。</p>
<h3><a href="https://webassembly.org/" title="WebAssembly">WebAssembly</a> コードのバインド</h3>
<p><code>hello/wasm.js</code> ファイルは生成した <a href="https://webassembly.org/" title="WebAssembly">WebAssembly</a> コードを JavaScript 側にバインドするものである。
今回は以下のように書いてみた。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">initWASM</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">go</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Go</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;instantiateStreaming&#39;</span> <span class="k">in</span> <span class="nx">WebAssembly</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">WebAssembly</span><span class="p">.</span><span class="nx">instantiateStreaming</span><span class="p">(</span><span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">),</span> <span class="nx">go</span><span class="p">.</span><span class="nx">importObject</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">go</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">instance</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">fetch</span><span class="p">(</span><span class="nx">WASM_URL</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">resp</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nx">resp</span><span class="p">.</span><span class="nx">arrayBuffer</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">bytes</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nx">WebAssembly</span><span class="p">.</span><span class="nx">instantiate</span><span class="p">(</span><span class="nx">bytes</span><span class="p">,</span> <span class="nx">go</span><span class="p">.</span><span class="nx">importObject</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">go</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">instance</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>これで</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">initWASM</span><span class="p">(</span><span class="s1">&#39;hello2.wasm&#39;</span><span class="p">);</span>
</span></span></code></pre></div><p>という感じに任意の <a href="https://webassembly.org/" title="WebAssembly">WebAssembly</a> ファイルを取り込める。</p>
<h3>HTML の内容</h3>
<p>以上を踏まえて <code>hello/index.html</code> ファイルの内容は以下のようにした。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;utf-8&#34;</span><span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Hello<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;wasm_exec.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;wasm.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">p</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;hello&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">initWASM</span><span class="p">(</span><span class="s2">&#34;hello2.wasm&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></div><h3>実行結果</h3>
<p>では，いよいよ動かしてみよう。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">$ go run main.go
</span></span><span class="line"><span class="cl">Open http://localhost:3000/
</span></span><span class="line"><span class="cl">Press ctrl+c to stop
</span></span></code></pre></div><p>該当の URL を開くと</p>
<figure style='margin:0 auto;text-align:center;'><a href="./hello1.png"><img src="./hello1.png" srcset="./hello1.png 500w" sizes="(min-width:600px) 500px, 80vw" alt="Hello" loading="lazy"></a><figcaption><div><a href="./hello1.png">Hello</a></div></figcaption>
</figure>
<p>よーし，ちゃんと表示されているな。
ここまでは楽勝。</p>
<h2><a href="https://webassembly.org/" title="WebAssembly">WebAssembly</a> の機能を JavaScript から呼び出す</h2>
<p>以上のコードは <a href="https://webassembly.org/" title="WebAssembly">WebAssembly</a> 側から HTML 要素に値をセットしていたが，これではあまり応用できないだろう。
なので，今度は JavaScript 側から <a href="https://webassembly.org/" title="WebAssembly">WebAssembly</a> の機能を呼び出すことを考える。</p>
<p>まずは <code>hello/hello.go</code> ファイルの内容を以下のように変更する。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// +build js,wasm</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;strings&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;syscall/js&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">say</span><span class="p">(</span><span class="nx">this</span> <span class="nx">js</span><span class="p">.</span><span class="nx">Value</span><span class="p">,</span> <span class="nx">args</span> <span class="p">[]</span><span class="nx">js</span><span class="p">.</span><span class="nx">Value</span><span class="p">)</span> <span class="kd">interface</span><span class="p">{}</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">ss</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">jss</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">args</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nx">s</span> <span class="o">:=</span> <span class="nf">jsString</span><span class="p">(</span><span class="nx">jss</span><span class="p">);</span> <span class="nx">s</span> <span class="o">!=</span> <span class="s">&#34;&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">ss</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">ss</span><span class="p">,</span> <span class="nx">s</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">js</span><span class="p">.</span><span class="nf">ValueOf</span><span class="p">(</span><span class="s">&#34;Hello, &#34;</span> <span class="o">+</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">Join</span><span class="p">(</span><span class="nx">ss</span><span class="p">,</span> <span class="s">&#34;, &#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">jsString</span><span class="p">(</span><span class="nx">j</span> <span class="nx">js</span><span class="p">.</span><span class="nx">Value</span><span class="p">)</span> <span class="kt">string</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">j</span><span class="p">.</span><span class="nf">IsUndefined</span><span class="p">()</span> <span class="o">||</span> <span class="nx">j</span><span class="p">.</span><span class="nf">IsNull</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">j</span><span class="p">.</span><span class="nf">String</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">ch</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kd">struct</span><span class="p">{})</span>
</span></span><span class="line"><span class="cl">    <span class="nx">js</span><span class="p">.</span><span class="nf">Global</span><span class="p">().</span><span class="nf">Set</span><span class="p">(</span><span class="s">&#34;say&#34;</span><span class="p">,</span> <span class="nx">js</span><span class="p">.</span><span class="nf">FuncOf</span><span class="p">(</span><span class="nx">say</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;-</span><span class="nx">ch</span> <span class="c1">// Code must not finish</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>JavaScript から呼び出す関数は</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span><span class="p">(</span><span class="nx">this</span> <span class="nx">js</span><span class="p">.</span><span class="nx">Value</span><span class="p">,</span> <span class="nx">args</span> <span class="p">[]</span><span class="nx">js</span><span class="p">.</span><span class="nx">Value</span><span class="p">)</span> <span class="kd">interface</span><span class="p">{}</span>
</span></span></code></pre></div><p>の関数型にする決まりのようだ。
また返り値は <a href="https://golang.org/pkg/syscall/js/" title="js - The Go Programming Language"><code>js</code></a><code>.Value</code> 型にして返すのだが，実際の <a href="https://go.dev/">Go</a> の型と JavaScript の型の対応は以下のようになっているらしい。</p>
<figure lang="en">
<blockquote class="nobox" cite="https://golang.org/pkg/syscall/js/#ValueOf"><table>
  <thead>
      <tr>
          <th>Go</th>
          <th>JavaScript</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>js.Value</code></td>
          <td>[its value]</td>
      </tr>
      <tr>
          <td><code>js.Func</code></td>
          <td><code>function</code></td>
      </tr>
      <tr>
          <td><code>nil</code></td>
          <td><code>null</code></td>
      </tr>
      <tr>
          <td><code>bool</code></td>
          <td><code>boolean</code></td>
      </tr>
      <tr>
          <td>integers and floats</td>
          <td><code>number</code></td>
      </tr>
      <tr>
          <td><code>string</code></td>
          <td><code>string</code></td>
      </tr>
      <tr>
          <td><code>[]interface{}</code></td>
          <td><code>new array</code></td>
      </tr>
      <tr>
          <td><code>map[string]interface{}</code></td>
          <td><code>new object</code></td>
      </tr>
  </tbody>
</table>
</blockquote>
<figcaption><div>via <q><a href="https://golang.org/pkg/syscall/js/#ValueOf">js - The Go Programming Language</a></q></div></figcaption>
</figure>
<p>さらに <code>main()</code> 関数内の</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">js</span><span class="p">.</span><span class="nf">Global</span><span class="p">().</span><span class="nf">Set</span><span class="p">(</span><span class="s">&#34;say&#34;</span><span class="p">,</span> <span class="nx">js</span><span class="p">.</span><span class="nf">FuncOf</span><span class="p">(</span><span class="nx">say</span><span class="p">))</span>
</span></span></code></pre></div><p>によって <a href="https://go.dev/">Go</a> の <code>say()</code> 関数は JavaScript の <code>global.say()</code> 関数に紐付けられる。</p>
<p><code>hello/wasm.js</code> ファイルはそのままでOK。
<code>hello/index.html</code> ファイルの内容を以下のように書き換える。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;utf-8&#34;</span><span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Hello<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;wasm_exec.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;wasm.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">	<span class="p">&lt;</span><span class="nt">button</span><span class="p">&gt;</span>Hello<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">	<span class="p">&lt;</span><span class="nt">p</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;hello&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">	<span class="nx">initWASM</span><span class="p">(</span><span class="s1">&#39;hello2.wasm&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">event</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;hello&#34;</span><span class="p">).</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">global</span><span class="p">.</span><span class="nx">say</span><span class="p">(</span><span class="s2">&#34;Alice&#34;</span><span class="p">,</span> <span class="s2">&#34;Bob&#34;</span><span class="p">,</span> <span class="s2">&#34;Chris&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>これで <code>[Hello]</code> ボタン押下で <code>global.say()</code> 関数が発火するはずである。
実行してみよう。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">$ go run main.go
</span></span><span class="line"><span class="cl">Open http://localhost:3000/
</span></span><span class="line"><span class="cl">Press ctrl+c to stop
</span></span></code></pre></div><p>この状態で画面を表示すると</p>
<figure style='margin:0 auto;text-align:center;'><a href="./hello-button1.png"><img src="./hello-button1.png" srcset="./hello-button1.png 500w" sizes="(min-width:600px) 500px, 80vw" alt="Hello Button (1)" loading="lazy"></a><figcaption><div><a href="./hello-button1.png">Hello Button (1)</a></div></figcaption>
</figure>
<p>さらにボタンを押下すると</p>
<figure style='margin:0 auto;text-align:center;'><a href="./hello-button2.png"><img src="./hello-button2.png" srcset="./hello-button2.png 500w" sizes="(min-width:600px) 500px, 80vw" alt="Hello Button (2)" loading="lazy"></a><figcaption><div><a href="./hello-button2.png">Hello Button (2)</a></div></figcaption>
</figure>
<p>よーし，うむうむ，よーし。</p>
<p>これなら応用が効きそうかな。
今回はここまで。</p>
<h2>ブックマーク</h2>
<ul>
<li><a href="https://github.com/golang/go/wiki/WebAssembly">WebAssembly · golang/go Wiki · GitHub</a></li>
<li><a href="https://wasmer.io/posts/wasmer-go-embedding-1.0">Wasmer Go embedding 1.0 lift-off</a>
<ul>
<li><a href="https://github.com/wasmerio/wasmer-go">GitHub - wasmerio/wasmer-go: 🐹🕸️ WebAssembly runtime for Go</a></li>
</ul>
</li>
<li><a href="https://wasmbyexample.dev/examples/webassembly-linear-memory/webassembly-linear-memory.go.en-us.html">Wasm By Example</a></li>
<li><a href="https://bearmini.hatenablog.com/entry/2019/12/23/173924">Go 製 WebAssembly ホスト環境パッケージ wax のご紹介 - bearmini&rsquo;s blog</a></li>
<li><a href="https://buildersbox.corp-sansan.com/entry/2019/02/14/113000">Go × WebAssemblyで電卓のWebアプリを作ってみた - Sansan Builders Blog</a></li>
<li><a href="https://qiita.com/takewell/items/c99b44d912448e9170e6">WASI (WebAssembly system interface) を Wasmtime と Node.js で試す - Qiita</a></li>
<li><a href="https://zenn.dev/ikawaha/articles/20210331-e661ac866f5ff0fc5eb8">Go の形態素解析器を wasm で利用する</a> : このコード例は参考になる</li>
</ul>
<h2>参考図書</h2>
<div class="hreview">
  <div class="photo"><a href="https://www.amazon.co.jp/dp/B08T7D2LFR?tag=baldandersinf-22&amp;linkCode=ogi&amp;th=1&amp;psc=1"><img src="https://m.media-amazon.com/images/I/51hVE3r&#43;6XL._SL160_.jpg" width="113" alt="photo"></a></div>
  <dl>
    <dt class="item"><a class="fn url" href="https://www.amazon.co.jp/dp/B08T7D2LFR?tag=baldandersinf-22&amp;linkCode=ogi&amp;th=1&amp;psc=1">ソフトウェアデザイン 2021年3月号</a></dt>
    <dd>谷本 心 (著), 水島 宏太 (著), 増田 亨 (著), 山本 悠滋 (著), 折原 レオナルド賢 (著), 米田 武 (著), 清水 洋治 (著), 結城 浩 (著), 刀根 諒 (著), 大串 肇 (著), 松本 直人 (著), クラスメソッド 木村(作) (著), エクスデザイン ninnzinn(画) (著), くつなりょうすけ (著), 広木 大地 (著), 中島 明日香 (著), 金谷 拓哉 (著), 高橋 永成 (著), 平岡 正寿 (著), 梶原 直人(監修) (著), 平櫛 貴章 (著), 星川 真麻 (著), けんちょん(大槻 兼資) (著), 大嶋 健容 (著), 職業「戸倉彩」 (著), mattn (著), 小野 輝也 (著), 濱田 康貴 (著), 森若 和雄 (著), 古川 菜摘 (著), 嘉山 陽一 (著), 平野 尚志 (著), 杉山 貴章 (著), Software Design編集部 (編集)</dd>
    <dd>技術評論社 2021-02-18 (Release 2021-02-18)</dd>
    <dd>雑誌</dd>
    <dd>B08T7D2LFR (ASIN), 4910058270316 (EAN)</dd>
    <dd>評価<abbr class="rating fa-sm" title="3">&nbsp;<i class="fas fa-star"></i>&nbsp;<i class="fas fa-star"></i>&nbsp;<i class="fas fa-star"></i>&nbsp;<i class="far fa-star"></i>&nbsp;<i class="far fa-star"></i></abbr></dd>
  </dl>
  <p class="description">第2特集が「WebAssembly 入門」近年の動向を把握するには丁度いいだろう。</p>
  <p class="powered-by">reviewed by <a href='#maker' class='reviewer'>Spiegel</a> on <abbr class="dtreviewed" title="2021-03-21">2021-03-21</abbr> (powered by <a href="https://affiliate.amazon.co.jp/assoc_credentials/home">PA-APIv5</a>)</p>
</div> <!-- ソフトウェアデザイン 2021年3月号 -->
<div class="hreview">
  <div class="photo"><a href="https://www.amazon.co.jp/dp/4621300253?tag=baldandersinf-22&amp;linkCode=ogi&amp;th=1&amp;psc=1"><img src="https://m.media-amazon.com/images/I/41meaSLNFfL._SL160_.jpg" width="122" alt="photo"></a></div>
  <dl>
    <dt class="item"><a class="fn url" href="https://www.amazon.co.jp/dp/4621300253?tag=baldandersinf-22&amp;linkCode=ogi&amp;th=1&amp;psc=1">プログラミング言語Go (ADDISON-WESLEY PROFESSIONAL COMPUTING SERIES)</a></dt>
    <dd>Alan A.A. Donovan (著), Brian W. Kernighan (著), 柴田 芳樹 (翻訳)</dd>
    <dd>丸善出版 2016-06-20</dd>
    <dd>単行本（ソフトカバー）</dd>
    <dd>4621300253 (ASIN), 9784621300251 (EAN), 4621300253 (ISBN)</dd>
    <dd>評価<abbr class="rating fa-sm" title="5">&nbsp;<i class="fas fa-star"></i>&nbsp;<i class="fas fa-star"></i>&nbsp;<i class="fas fa-star"></i>&nbsp;<i class="fas fa-star"></i>&nbsp;<i class="fas fa-star"></i></abbr></dd>
  </dl>
  <p class="description">著者のひとりは（あの「バイブル」とも呼ばれる）通称 “K&amp;R” の K のほうである。この本は Go 言語の教科書と言ってもいいだろう。と思ったら絶版状態らしい（2025-01 現在）。復刊を望む！</p>
  <p class="powered-by">reviewed by <a href='#maker' class='reviewer'>Spiegel</a> on <abbr class="dtreviewed" title="2016-07-13">2016-07-13</abbr> (powered by <a href="https://affiliate.amazon.co.jp/assoc_credentials/home">PA-APIv5</a>)</p>
</div> <!-- プログラミング言語Go -->

</section>

</article>
</main>
<nav class="page-nav">
<div class="prev-page">&laquo; <a href="/golang/special-forms/">特殊形式による式評価について</a></div>
<div class="next-page"><a href="/golang/wasi-with-tinygo/">TinyGo で WASI 【失敗編】</a> &raquo;</div>
</nav>

<aside class="feedback" id='feedback'>
<h1>Feedback</h1>
<p>GitHub に<a href="https://github.com/spiegel-im-spiegel/github-pages-env/discussions">フィードバック用のディスカッションページ</a>を用意しました。
書き込みには GitHub のアカウントが必要ですが，お気軽にご利用ください。</p>
<p>他のフィードバック手段として Mastodon などの SNS や電子メールも利用できます。電子メールを利用する際の公開鍵は<a href="https://baldanders.info/profile/">プロフィール</a>から取得できます。</p>
</aside>
<footer>


<div class="userinfo">
	<div class="userinfo-avater">
		<a href="https://baldanders.info/profile/"><img src="https://text.baldanders.info/images/avatar.jpg" width="48" height="48" alt="avatar" id="logo"></a>
	</div>
	<div class="userinfo-info" id="maker">
		Text by <a href="https://baldanders.info/profile/" rel="cc:attributionURL" property="cc:attributionName">Spiegel</a>
		in <time property='dc:dateCopyrighted'>2021-03-11</time> (revised in 2024-05-11)
		<a rel='cc:license' href="https://creativecommons.org/licenses/by-sa/4.0/"><i class="fab fa-creative-commons"></i>&nbsp;<i class="fab fa-creative-commons-by"></i>&nbsp;<i class="fab fa-creative-commons-sa"></i></a>
		<ul class="social"><li><a rel="me" href="https://github.com/spiegel-im-spiegel"><span class="github-color"><abbr title="GitHub"><i class="fab fa-github"></i></abbr></span></a></li><li><a rel="me" href="https://www.flickr.com/photos/spiegel/"><span class="flickr-color"><abbr title="Flickr"><i class="fab fa-flickr"></i></abbr></span></a></li><li><a rel="me" href="https://goark.fedicity.net/@spiegel"><span class="mastodon-color"><abbr title="Mastodon"><i class="fa-brands fa-mastodon"></i></abbr></span></a></li><li><a rel="me" href="https://bsky.app/profile/baldanders.info"><span class="bluesky-color"><abbr title="Bluesky"><i class="fa-brands fa-bluesky"></i></abbr></span></a></li></ul>
	</div>
</div>

<nav>
<ul class='cloud center'>
<li><a href='/about-feeds/'>Feeds</a></li>
<li><a href='/reviews/'>Reviews</a></li>
<li><a href='/site-policy/'>Policy</a></li>
<li><a href='https://github.com/spiegel-im-spiegel/spiegel-im-spiegel.github.io'>Repository</a></li>
<li><a href='https://validator.w3.org/nu/?doc=https%3a%2f%2ftext.baldanders.info%2fgolang%2fwebassembly-with-tinygo%2f&amp;showoutline=yes'>Debug</a></li>
</ul>
<ul class='cloud center'>
<li><a href='https://baldanders.info/'>Home</a></li>
<li><a href='https://photo.baldanders.info/'>Photos</a></li>
<li><a href='https://slide.baldanders.info/'>Slide</a></li>
<li><a href='https://zenn.dev/spiegel'>Zenn</a></li>
</ul>
<ul class='cloud center'>
<li>Powered by <a href='https://gohugo.io/'>Hugo 0.146.7</a> and <a href="https://github.com/spiegel-im-spiegel/hugo-theme-baldanders-info
">Theme of Baldanders.info</a>.</li>
</ul>
</nav>
</footer>
</div>

</body>
</html>
