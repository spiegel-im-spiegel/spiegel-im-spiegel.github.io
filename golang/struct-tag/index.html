<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="generator" content="Hugo 0.18.1" />
<link rel="icon" type="image/x-icon" href="/favicon.ico">
<link rel='stylesheet' href='//fonts.googleapis.com/css?family=Noto+Serif%7cNoto+Sans%3a400,700%7cInconsolata%3a400,700' type='text/css'>
<link rel='stylesheet' href='//fonts.googleapis.com/earlyaccess/notosansjp.css' type='text/css'>
<link rel='stylesheet' href='//fonts.googleapis.com/earlyaccess/sawarabimincho.css' type='text/css'>
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/cc-icons/1.2.1/css/cc-icons.min.css">
<link rel="stylesheet" href="/css/main.css">
<link rel="stylesheet" href="/css/text-baldanders.css">
<link rel="alternate" href="http://text.baldanders.info/index.xml" type="application/rss+xml" title="text.Baldanders.info">
<meta name="google-site-verification" content="jTjBCslPtf8gwVatiY-GDgGv7pV5csa8aUOw1MRPUD4">
<link rel="stylesheet" href="/css/addon.css">
<link rel="stylesheet" href="/highlightjs/styles/github.css">
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML&amp;locale=ja"></script>
<script>
  MathJax.Hub.Config({
    TeX: {
      extensions: ["autoload-all.js"],
      equationNumbers: { autoNumber: "all" }
    },
    tex2jax: {
      inlineMath: [['$','$'], ['\\(','\\)']],
      processEscapes: true
    },
    "HTML-CSS": {
      matchFontHeight: false,
      preferredFont: null,
      webFont: "TeX"
    },
    displayAlign: "left",
    displayIndent: "2em"
  });
</script>
<title>Struct タグについて — プログラミング言語 Go | text.Baldanders.info</title>
<meta name="description" content="Struct で正規化できる情報であれば，タグを使うことでアプリケーション外部とのやり取りがずっと楽になる。">
<meta name="author" content="Spiegel">
<meta name="keywords" content="golang,struct,tags,marshal">
<link rel='prev' href='http://text.baldanders.info/golang/unicode-normalization/' title='Go 言語と Unicode 正規化' />
<link rel='next' href='http://text.baldanders.info/golang/stack-trace-and-panic-handling/' title='スタック追跡とパニック・ハンドリング' />
</head>
<body>

<div id='container'>
<header>
<div id="sitetitle"><a href="http://text.baldanders.info/">text.Baldanders.info</a> <a href='/index.xml' title='Feed'><i class='fa fa-rss'></i></a></div>
<p>帰ってきた「しっぽのさきっちょ」</p>
</header>


<main>
<article itemscope itemtype='http://schema.org/BlogPosting' itemref='maker'>
<h1 itemprop='name'>Struct タグについて — <a href="/golang">プログラミング言語 Go</a></h1>
<nav class="tags">
<div><a href="/tags">Tags</a>: #<a href="/tags/golang">golang</a> #<a href="/tags/marshal">marshal</a> #<a href="/tags/struct">struct</a> #<a href="/tags/tags">tags</a></div>
<div><a href="https://github.com/spiegel-im-spiegel/spiegel-im-spiegel.github.io/commits/master/golang/struct-tag/index.html">History</a></div>
</nav>

<section>


<p>たとえば <a href="https://golang.org/ref/spec#Struct_types" title="Struct types">struct</a> で構造化されている情報を特定のファイルやデータベースに出力したり，逆にファイルやデータベースの情報を <a href="https://golang.org/ref/spec#Struct_types" title="Struct types">struct</a> に流し込みたい場合に <a href="https://golang.org/ref/spec#Struct_types" title="Struct types">struct</a> の各フィールドに目印になる情報があると便利である。
この目印として機能するのが <a href="https://golang.org/ref/spec#Struct_types" title="Struct types">struct</a> タグである<sup class="footnote-ref" id="fnref:an"><a rel="footnote" href="#fn:an">1</a></sup>。</p>

<p><a href="https://golang.org/ref/spec#Struct_types" title="Struct types">struct</a> タグは以下のように記述する。</p>

<figure lang="en">
<blockquote>
<q>By convention, tag strings are a concatenation of optionally space-separated key:"value" pairs. Each key is a non-empty string consisting of non-control characters other than space (U+0020 ' '), quote (U+0022 '"'), and colon (U+003A ':'). Each value is quoted using U+0022 '"' characters and Go string literal syntax.</q>
</blockquote>
<figcaption>via <q><a href="https://golang.org/pkg/reflect/#example_StructTag">reflect - The Go Programming Language</a></q></figcaption>
</figure>

<pre><code class="language-go">type Server struct {
	Host      string `elem:&quot;host&quot;`
	IPAddress string `elem:&quot;ip_address&quot;`
	Port      int    `elem:&quot;port&quot;`
	Note      string `elem:&quot;note&quot;`
}
</code></pre>

<p>このタグ情報を取得するには <a href="https://golang.org/pkg/reflect/" title="reflect - The Go Programming Language"><code>reflect</code></a> パッケージを使う。
たとえばこんな感じ。</p>

<pre><code class="language-go">package main

import (
	&quot;fmt&quot;
	&quot;reflect&quot;
)

type Server struct {
	Host      string `elem:&quot;host&quot;`
	IPAddress string `elem:&quot;ip_address&quot;`
	Port      int    `elem:&quot;port&quot;`
	Note      string `elem:&quot;note&quot;`
}

func main() {
	s := Server{}
	t := reflect.TypeOf(s)
	for i := 0; i &lt; t.NumField(); i++ {
		field := t.Field(i)
		fmt.Printf(&quot;Name=%s , tag(elem)=%s\n&quot;, field.Name, field.Tag.Get(&quot;elem&quot;))
	}
}
</code></pre>

<p>これを実行するとこうなる。</p>

<pre><code>Name=Host , tag(elem)=host
Name=IPAddress , tag(elem)=ip_address
Name=Port , tag(elem)=port
Name=Note , tag(elem)=note
</code></pre>

<p>実際には <a href="https://golang.org/pkg/reflect/" title="reflect - The Go Programming Language"><code>reflect</code></a> を直接使う局面は少なく，既にあるパッケージを利用することが多い。
たとえば <a href="https://golang.org/ref/spec#Struct_types" title="Struct types">struct</a> による構造化データを <a href="https://tools.ietf.org/html/rfc7159" title="RFC 7159 - The JavaScript Object Notation (JSON) Data Interchange Format">JSON</a> 形式に出力する <a href="https://golang.org/pkg/encoding/json/" title="json - The Go Programming Language"><code>encoding/json</code></a> パッケージがある。</p>

<pre><code class="language-go">package main

import (
	&quot;encoding/json&quot;
	&quot;fmt&quot;
)

type Server struct {
	Host      string `json:&quot;host&quot;`
	IPAddress string `json:&quot;ip_address&quot;`
	Port      int    `json:&quot;port&quot;`
	Note      string `json:&quot;note&quot;`
}

func main() {
	s := Server{Host: &quot;localhost&quot;, IPAddress: &quot;127.0.0.1&quot;, Port: 8080, Note: &quot;Web Application&quot;}
	j, err := json.MarshalIndent(s, &quot;&quot;, &quot;  &quot;)
	if err != nil {
		return
	}
	fmt.Println(string(j))
}
</code></pre>

<p>これを実行するとこうなる。</p>

<pre><code>{
  &quot;host&quot;: &quot;localhost&quot;,
  &quot;ip_address&quot;: &quot;127.0.0.1&quot;,
  &quot;port&quot;: 8080,
  &quot;note&quot;: &quot;Web Application&quot;
}
</code></pre>

<p><code>Server</code> の内容が <a href="https://tools.ietf.org/html/rfc7159" title="RFC 7159 - The JavaScript Object Notation (JSON) Data Interchange Format">JSON</a> 形式で出力されているのが分かるだろう。
<a href="https://tools.ietf.org/html/rfc7159" title="RFC 7159 - The JavaScript Object Notation (JSON) Data Interchange Format">JSON</a> の要素名がタグで指定した名前になっていることを確認してほしい。</p>

<p>反対もやってみよう。</p>

<pre><code class="language-go">package main

import (
	&quot;encoding/json&quot;
	&quot;fmt&quot;
)

type Server struct {
	Host      string `json:&quot;host&quot;`
	IPAddress string `json:&quot;ip_address&quot;`
	Port      int    `json:&quot;port&quot;`
	Note      string `json:&quot;note&quot;`
}

func main() {
	svr := []byte(`{
  &quot;host&quot;: &quot;localhost&quot;,
  &quot;ip_address&quot;: &quot;127.0.0.1&quot;,
  &quot;port&quot;: 8080,
  &quot;note&quot;: &quot;Web Application&quot;
}`)
	var s Server
	if err := json.Unmarshal(svr, &amp;s); err != nil {
		return
	}
	fmt.Println(s)
}
</code></pre>

<p>実行結果はこうなる。</p>

<pre><code>{localhost 127.0.0.1 8080 Web Application}
</code></pre>

<p>きれいに <a href="https://golang.org/ref/spec#Struct_types" title="Struct types">struct</a> に値が入っているのが分かると思う。</p>

<p>ちなみにタグの書式は <code>key:&quot;value&quot;</code> だが，間違って記述しても単に無視されるだけでコンパイル時も実行時もエラーにならないので注意が必要である。
なおタグ書式の文法ミスについては，静的検査ツールの <a href="https://golang.org/cmd/vet/" title="vet - The Go Programming Language">vet</a> でチェックできる。</p>

<p>タグは複数列挙することができる。
たとえばサンプルの構造体を <a href="https://github.com/toml-lang/toml" title="toml-lang/toml: Tom's Obvious, Minimal Language">TOML</a> にも対応させたいなら</p>

<pre><code class="language-go">type Server struct {
	Host      string `json:&quot;host&quot; toml:&quot;host&quot;`
	IPAddress string `json:&quot;ip_address&quot; toml:&quot;ip_address&quot;`
	Port      int    `json:&quot;port&quot; toml:&quot;port&quot;`
	Note      string `json:&quot;note&quot; toml:&quot;note&quot;`
}
</code></pre>

<p>などとする（デリミタは空白文字）。
じゃあ，先ほどと同じようにして <a href="https://github.com/toml-lang/toml" title="toml-lang/toml: Tom's Obvious, Minimal Language">TOML</a> で出力してみる。
<a href="https://github.com/toml-lang/toml" title="toml-lang/toml: Tom's Obvious, Minimal Language">TOML</a> を扱うには <a href="https://github.com/BurntSushi/toml"><code>github.com/BurntSushi/toml</code></a> パッケージを使うとよい。</p>

<pre><code class="language-go">package main

import (
	&quot;bytes&quot;
	&quot;fmt&quot;

	&quot;github.com/BurntSushi/toml&quot;
)

type Server struct {
	Host      string `json:&quot;host&quot; toml:&quot;host&quot;`
	IPAddress string `json:&quot;ip_address&quot; toml:&quot;ip_address&quot;`
	Port      int    `json:&quot;port&quot; toml:&quot;port&quot;`
	Note      string `json:&quot;note&quot; toml:&quot;note,omitempty&quot;`
}

func main() {
	s := Server{Host: &quot;localhost&quot;, IPAddress: &quot;127.0.0.1&quot;, Port: 8080, Note: &quot;&quot;}
	t := new(bytes.Buffer)
	if err := toml.NewEncoder(t).Encode(s); err != nil {
		return
	}
	fmt.Println(t.String())
}
</code></pre>

<p>実行結果は以下の通り。</p>

<pre><code>host = &quot;localhost&quot;
ip_address = &quot;127.0.0.1&quot;
port = 8080
</code></pre>

<p><code>omitempty</code> オプションはフィールドが空（<code>nil</code> または空文字列）の場合に出力を省略できる<sup class="footnote-ref" id="fnref:oz"><a rel="footnote" href="#fn:oz">2</a></sup>。
このオプションは <a href="https://golang.org/pkg/encoding/json/" title="json - The Go Programming Language"><code>encoding/json</code></a> パッケージでも使える。</p>

<p>ついでに反対もやってみよう。</p>

<pre><code class="language-go">package main

import (
	&quot;fmt&quot;

	&quot;github.com/BurntSushi/toml&quot;
)

type Server struct {
	Host      string `json:&quot;host&quot; toml:&quot;host&quot;`
	IPAddress string `json:&quot;ip_address&quot; toml:&quot;ip_address&quot;`
	Port      int    `json:&quot;port&quot; toml:&quot;port&quot;`
	Note      string `json:&quot;note&quot; toml:&quot;note,omitempty&quot;`
}

func main() {
	svr := `
host = &quot;localhost&quot;
ip_address = &quot;127.0.0.1&quot;
port = 8080
note = &quot;Web Application&quot;
`
	var s Server
	if _, err := toml.Decode(svr, &amp;s); err != nil {
		return
	}
	fmt.Println(s)
}
</code></pre>

<p>結果は以下の通り。</p>

<pre><code>{localhost 127.0.0.1 8080 Web Application}
</code></pre>

<p>このように <a href="https://golang.org/ref/spec#Struct_types" title="Struct types">struct</a> で正規化できる情報であれば，タグ機能を使うことでアプリケーション外部とのやり取りがだいぶ楽になる。</p>

<h2 id="ブックマーク">ブックマーク</h2>

<ul>
<li><a href="http://hiyosi.tumblr.com/post/100922038678/go-%E3%81%A7-struct-%E3%81%AE%E3%82%BF%E3%82%B0%E6%83%85%E5%A0%B1%E3%82%92%E5%8F%96%E5%BE%97%E3%81%99%E3%82%8B">Go で struct のタグ情報を取得する - hiyosi&rsquo;s blog</a></li>
<li><a href="http://qiita.com/amanoiverse/items/fcd25db64f341ad2471f">struct にアノテーションつけてたら go vet . すべき - Qiita</a></li>
<li><a href="http://blog.restartr.com/2014/08/13/golang-json-marshal-unmarshal/">Goのjson.Marshal/Unmarshalの仕様を整理してみる - I Will Survive</a></li>
<li><a href="http://qiita.com/reiki4040/items/6556d4eba797329e9f51">BurntSushi/tomlを使ってハマったこと - Qiita</a></li>
<li><a href="http://qiita.com/hnakamur/items/ba363e82332d4dbdf34a">GoでJSONの一部分を利用者が定義した構造体に読み込める便利な手法を見つけた - Qiita</a></li>
<li><a href="http://qiita.com/iktakahiro/items/2e240147ca3188948a17">Go 言語 1つの構造体に複数の validation を適応する - Qiita</a> : <a href="https://golang.org/ref/spec#Struct_types" title="Struct types">struct</a> タグに validation 情報を埋め込んで利用する</li>
</ul>

<p><a href="http://text.baldanders.info/golang/bookmark/">Go 言語に関するブックマーク集はこちら</a>。</p>
<div class="footnotes">

<hr />

<ol>
<li id="fn:an">「アノテーション（annotation）」と呼ぶ人もいる。たぶん Java の annotation 機能を意識しているんだろう。
 <a class="footnote-return" href="#fnref:an"><sup>[return]</sup></a></li>
<li id="fn:oz">数値の場合は <code>omitzero</code> オプションを付けると 0 のときに出力を省略できる。ただし <a href="https://github.com/BurntSushi/toml"><code>BurntSushi/toml</code></a> パッケージでは <a href="http://qiita.com/reiki4040/items/6556d4eba797329e9f51"><code>Decode()</code> がうまく動かない</a>らしい。実は <code>omitempty</code> オプションも <code>Decode()</code> 時の挙動が怪しいんだよなぁ。 <a href="https://github.com/toml-lang/toml" title="toml-lang/toml: Tom's Obvious, Minimal Language">TOML</a> パーサの別実装としては <a href="https://github.com/naoina/toml">naoina/toml</a> というのもある。これは最新の <a href="https://github.com/toml-lang/toml" title="toml-lang/toml: Tom's Obvious, Minimal Language">TOML</a> 仕様に追随しているようだが <code>omitzero</code> オプションには対応していない。
 <a class="footnote-return" href="#fnref:oz"><sup>[return]</sup></a></li>
</ol>
</div>

</section>

</article>
</main>
<nav class="page-nav">
<div class="prev-page">&laquo; <a href="/golang/unicode-normalization/">Go 言語と Unicode 正規化</a></div>
<div class="next-page"><a href="/golang/stack-trace-and-panic-handling/">スタック追跡とパニック・ハンドリング</a> &raquo;</div>
</nav>

<aside id='tech-terms'>
<style scoped>
#tech-terms h1 {
  border: solid thin gray;
  margin: 0 0 1rem 0;
  padding: 0 0.5rem 2px 2px;
}
</style>
<h1>Technical Terms</h1>
<div class="cloud" style="font-size:smaller;">
<script type="text/javascript" src="http://e-words.jp/embed.x?e=utf8"></script>
<p class="right">Powered by <a href="hhttp://e-words.jp/p/s-embed.html">e-Words</a></p>
</div>
</aside>
<aside id='feedback'>
<style scoped>
#feedback h1 {
  border: solid thin gray;
  margin: 0 0 1rem 0;
  padding: 0 0.5rem 2px 2px;
}
</style>
<h1>Feedback</h1>
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'textbaldandersinfo';
    var disqus_identifier = 'http:\/\/text.baldanders.info\/golang\/struct-tag\/';
    var disqus_title = 'Struct タグについて';
    var disqus_url = 'http:\/\/text.baldanders.info\/golang\/struct-tag\/';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</aside>

<footer>

	<div class="userinfo">
		<div class="userinfo-avater">
			
				<a href="http://www.baldanders.info/spiegel/profile/"><img src="/images/avatar.jpg" width="48" height="48" alt="avatar"></a>
			
		</div>
		<div class="userinfo-info" id="maker" itemprop='author' itemscope itemtype='http://schema.org/Person'>
			
				Written by <a href="http://www.baldanders.info/spiegel/profile/" rel="cc:attributionURL" property="cc:attributionName" itemprop='name'>Spiegel</a> in <time property='dc:dateCopyrighted'>2016-02-05</time> (revised in <time property='dc:modified'>2017-02-21</time>).
				
	<a rel='cc:license' href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank"><i class="cc cc-cc"></i>&nbsp;<i class="cc cc-by"></i>&nbsp;<i class="cc cc-sa"></i></a>

			
			
	<ul class="social">
		<li><a href="https://github.com/spiegel-im-spiegel" target="_blank"><i class="fa fa-github"></i></a></li>
		<li><a href="https://twitter.com/spiegel_2007" target="_blank"><i class="fa fa-twitter"></i></a></li>
		
		<li><a href="http://spiegel-im-spiegel.tumblr.com/" target="_blank"><i class="fa fa-tumblr"></i></a></li>
		<li><a href="http://instagram.com/spiegel_2007" target="_blank"><i class="fa fa-instagram"></i></a></li>
		<li><a href="https://www.flickr.com/photos/spiegel/" target="_blank"><i class="fa fa-flickr"></i></a></li>
		<li><a href="https://www.facebook.com/spiegel.im.spiegel" target="_blank"><i class="fa fa-facebook"></i></a></li>
		<li><a href="https://jp.linkedin.com/in/spiegelimspiegel" target="_blank"><i class="fa fa-linkedin"></i></a></li>
		
	</ul>
	<ul class="social">
		<li><a href="http://www.facebook.com/share.php?u=http%3a%2f%2ftext.baldanders.info%2fgolang%2fstruct-tag%2f" rel=”nofollow” target="_blank"><i class="fa fa-facebook-square fa-2x" aria-hidden="true"></i></a></li>
		<li><a href="http://twitter.com/share?text=Struct%20%e3%82%bf%e3%82%b0%e3%81%ab%e3%81%a4%e3%81%84%e3%81%a6&amp;url=http%3a%2f%2ftext.baldanders.info%2fgolang%2fstruct-tag%2f" rel=”nofollow” target="_blank"><i class="fa fa-twitter-square fa-2x" aria-hidden="true"></i></a></li>
		<li><a href="https://flattr.com/submit/auto?user_id=spiegel&amp;url=http%3a%2f%2ftext.baldanders.info%2fgolang%2fstruct-tag%2f&amp;title=Struct%20%e3%82%bf%e3%82%b0%e3%81%ab%e3%81%a4%e3%81%84%e3%81%a6" target="_blank"><img src="//button.flattr.com/flattr-badge-large.png" alt="Flattr this" title="Flattr this"></a></li>
	</ul>


		</div>
	</div>

<nav>
<ul class='cloud center'>
<li><a href='https://github.com/spiegel-im-spiegel/spiegel-im-spiegel.github.io'>Repository</a></li>
<li><a href='/reviews/'>Reviews</a></li>
<li><a href='/about-feeds/'>Feeds</a></li>
<li><a href='/site-policy/'>Site Policy</a></li>
<li><a href='https://validator.w3.org/nu/?doc=http%3a%2f%2ftext.baldanders.info%2fgolang%2fstruct-tag%2f&amp;showoutline=yes'>Debug</a></li>
</ul>
<ul class='cloud center'>
<li><a href='http://www.baldanders.info/'>Baldanders.info</a></li>
<li><a href='https://scrapbox.io/spiegel-branch/'>Scrapbox</a></li>
<li><a href='http://qiita.com/spiegel-im-spiegel'>Qiita</a></li>
</ul>
<ul class='cloud center'>
<li>Powered by <a href='http://gohugo.io/'>Hugo 0.18.1</a> and <a href="https://github.com/spiegel-im-spiegel/hugo-theme-text">Text</a>.</li>
</ul>
</nav>
</footer>

</div>
<script src="/highlightjs/highlight.pack.js"></script>
<script>
  hljs.configure({
    tabReplace: "    ",	
  });
  hljs.initHighlightingOnLoad();
</script>

</body>
</html>

